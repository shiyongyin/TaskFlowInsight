# TaskFlowInsight 整体项目 — 产品需求文档 (PRD)

> **作者**: 资深产品经理  
> **日期**: 2026-02-16  
> **版本**: v1.0  
> **范围**: TFI 产品整体（全模块）

---

## 1. 产品概述

### 1.1 产品愿景

> 让业务流程自己"说话" —— 通过自动化可视化与变更检测，让开发者在不修改业务代码的前提下，获得业务流程的 X 光透视能力。

### 1.2 产品形态

| 形态 | 说明 |
|------|------|
| Java 库 | Maven 依赖引入，非独立服务 |
| Spring Boot Starter | 自动配置，注解驱动 |
| 独立 Facade | 纯 Java 环境也可使用 |

---

## 2. 目标用户

| 角色 | 痛点 | TFI 价值 |
|------|------|----------|
| Java 后端开发 | 断点调试效率低，日志散乱 | 自动流程树，一键可视化 |
| 技术架构师 | 难以全局把握执行路径 | 结构化流程导出，审计追踪 |
| QA 工程师 | 对象变更难以追踪 | 自动 diff，精确到字段 |
| DevOps | 缺少业务级指标 | Actuator + Prometheus 集成 |

---

## 3. 核心价值与差异化

| 维度 | APM 工具 | TFI |
|------|----------|-----|
| 粒度 | 方法/RPC 级 | **业务语义级** |
| 变更追踪 | 无 | **深度对象 diff** |
| 集成方式 | Agent / SDK | **注解 + AOP** |
| 类型系统 | 无 | **@Entity/@ValueObject/@Key** |
| 部署模式 | 独立服务 | **纯库依赖** |

---

## 4. 功能全景

```
TaskFlowInsight
├── 🔵 任务流追踪 (Flow)       — GA
├── 🟢 变更追踪 (Tracking)     — GA
├── 🟡 对象比对 (Compare)      — GA
├── 🟠 注解驱动 (Annotation)   — GA
├── 🔴 监控运维 (Ops)          — Beta
└── 🟣 SPI 扩展 (v4.0.0)      — Alpha
```

---

## 5. 非功能性需求

| 指标 | 目标 |
|------|------|
| stage() 开销 | < 1μs |
| compare() 小对象 | < 100μs |
| 异常不外泄 | 100% |
| 零内存泄漏 | 100% |
| 线程安全 | 100% |

---

## 6. 版本路线图

| 版本 | 状态 | 关键特性 |
|------|------|----------|
| v3.0.0 | GA | 统一 DiffFacade、类型系统、多策略比对 |
| v4.0.0 | 开发中 | SPI Provider 路由、多模块拆分 |
| v4.1.0 | 规划中 | 中文文档、IDE 插件、OpenTelemetry |
| v5.0.0 | 远景 | 分布式追踪、Web UI、AI 辅助分析 |

---

## 7. 竞品分析

| 产品 | 类型 | TFI 差异 |
|------|------|----------|
| javers | 对象审计 | TFI = 流程 + 审计 |
| SkyWalking | APM | TFI 聚焦业务语义 |
| 自建 AOP 日志 | 自研 | TFI 开箱即用 |

---

## 8. 风险

| 风险 | 概率 | 缓解 |
|------|:----:|------|
| tfi-flow-core 版本不同步 | 中 | 统一版本管理 |
| 大对象 OOM | 低 | max-depth + 自动降级 |
| 社区采用不及预期 | 高 | 完善文档 + 布道 |
