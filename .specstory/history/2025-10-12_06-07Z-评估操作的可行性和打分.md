<!-- Generated by SpecStory -->

<!-- cursor Session 07d7cfb2-e8cf-45d2-8fad-c040df09ba58 (2025-10-12 06:07Z) -->

# 评估操作的可行性和打分 (2025-10-12 06:07Z)

_**User (2025-10-11 08:14Z)**_

读取文档结合当前代码实事求是评估下 操作的可行性多维度打分@claude/ 

---

_**Assistant (o3)**_



---

Tool use: **grep**

---

Tool use: **grep**

---



---

以下评估基于目前仓库实际代码（未发现 `ComparisonProvider`、`ProviderRegistry` 等 4.0.0 规划中的类文件）与任务卡 01～06 所述目标之间的差距，采用 0〜10 打分，越高表示越可行／风险越低。

1. 技术可实现性 9  
   • 方案基于标准 ServiceLoader、ConcurrentHashMap、ArchUnit、JaCoCo 等成熟技术；无硬性外部依赖。  
   • 与现行 v3.x 代码接口（TFI 门面等）语义一致，理论上可平滑嫁接。  

2. 与现有代码耦合度 6  
   • 当前单体模块内大量直接调用 CompareService / ChangeTracker，需逐一改路由；重构面广。  
   • v3.x 中部分类位于深层实现包，迁移到多模块后包名将改变，需批量 refactor。  

3. 工作量估算准确度 7  
   • 01 SPI & Registry（～18h）与 02 路由改造（～30h）为主要成本，合计约 48h。根据 260+ 源文件与 40 个公开方法规模，时间估算基本合理，但测试（2000 golden + jqwik）可能被低估。  

4. 质量门禁落地难度 8  
   • JaCoCo、diff-cover、japicmp、ArchUnit 均有现成 Maven 插件／CI Action；只需配置即可。  
   • diff-cover 需 Python，CI 已含 steps，成本可控。  

5. 组织／流程风险 6  
   • 代码大迁移＋多门禁同批次上线，PR 体积可能过大、review 压力大。  
   • 需要 DevOps 支持（GitHub Actions 缓存、Python 环境），以及团队对 ArchUnit/japicmp 误报的共识、豁免流程。  

6. 回滚/灰度能力 9  
   • 设计提供 FeatureFlag（`tfi.api.routing.enabled`）可一键回退至 v3.x 逻辑；Registry 本身不影响现有代码。  

7. 长期维护成本 8  
   • Provider 机制、模块化、ArchUnit 规则可显著降低后续架构腐化风险。  
   • 但 Registry 当前使用 `Map<Class<?>, List<Object>>` 的原始类型，后期若不偿还技术债（泛型安全、unregister）会留下隐患。  

8. 对现有用户兼容性 7  
   • 方法签名保持 + japicmp gate 可以保证二进制兼容。  
   • 行为级别仍需 ApprovalTests 覆盖全部 40 方法，现有文档未附示例，实际落地要补足。  

9. 性能影响 9  
   • Registry 缓存后 lookup P95<1 µs 属于低开销；仅首次 ServiceLoader 冷启动 <10 ms。  
   • 路由层一次间接调用对大部分用例可忽略不计。  

10. 安全 & 合规风险 8  
    • 设计已强调“禁止核心模块依赖 Spring / Micrometer”“provider 白名单” 等，ArchUnit 与后续改进计划覆盖大部分风险。  
    • 仍需关注 ServiceLoader 恶意 JAR 注入（白名单机制为 P2 任务）。  

综合可行性加权得分：  
(9＋6＋7＋8＋6＋9＋8＋7＋9＋8) / 10  ≈ **7.7 / 10**

结论  
1. 技术方案成熟，冷启动/热路径性能、回滚策略完备，可行性高。  
2. 主要挑战在于：  
   • 代码面迁移量大（40 方法改造 + 多模块拆分），需分批 PR、充分自动化测试。  
   • 门禁工具首次引入可能产生误报，需预留缓冲期与豁免流程。  
3. 建议迭代顺序：  
   ① 先落 SPI + Registry（Task 01），连同单元 & Chaos 测试。  
   ② 小批次重构 10〜12 个比较/追踪方法，ApprovalTests 验证行为不变。  
   ③ 引入 ArchUnit 规则与 japicmp，只检查“SPI 包无 Spring 依赖”“TFI 签名保持”两条核心规则，待稳定后再扩展到 8 条完整规则。  
   ④ 最后启用 diff-coverage gate，避免在大重构期间被频繁阻断。

按以上路径推进，可在 2～3 个迭代冲刺内安全落地 v4.0.0 目标。

---

_**User (2025-10-11 08:14Z)**_

实事求是分析距离10分还差什么

---

_**Assistant (o3)**_



---

要把当前 7.7 / 10 的整体可行性提升到满分 10 / 10，尚需弥补下列关键差距（按照影响权重由高到低排序）：

1. 代码落地与验证深度  
   • SPI 接口、ProviderRegistry、兜底实现以及 40 个 TFI 路由方法目前仍停留在设计文档，必须完成实码编写并跑通全部单元／集成／Chaos 测试。  
   • ApprovalTests 2000 个黄金用例、jqwik 属性测试尚未编写，缺乏行为一致性的硬证据。  

2. 多模块重构与大规模迁移风险  
   • 260+ 源文件中的直接服务调用需改为 Provider 路由，且要与 v3.x 版本保持二进制兼容。这一过程若无分批 PR 和自动化脚本，极易遗漏或引入回归。  
   • 模块拆分后包名变动，现有 import、反射代码、Spring 扫描路径都需同步调整。  

3. 泛型安全与生命周期管理  
   • ProviderRegistry 目前使用原始类型 `Map<Class<?>, List<Object>>`，存在运行期 `ClassCastException` 风险；需升级为泛型安全实现并补充 `unregister()` API，解决测试隔离与插件卸载场景。  

4. 安全与可插拔治理  
   • ServiceLoader 白名单、Provider 健康检查、严重错误与可恢复异常的区分都仅列为 P1 / P2 改进项，未真正落地。  
   • 缺少针对恶意 JAR 注入的签名校验或沙箱机制。  

5. 性能与容量基线  
   • JMH 冷启动／热路径基准、tfi-all 打包体积 ≤20 MB、Reactor 构建 <2 min 等指标尚无实测报告；一旦超标无法第一时间预警。  

6. 质量门禁误报与维护成本  
   • ArchUnit 8 条规则、japicmp、diff-cover 同期引入，初期误报在所难免；需要完善白名单、规则文档与豁免流程，否则可能拖慢 CI。  
   • diff-cover 目前仅支持单模块，聚合报告脚本未实现。  

7. 升级／迁移体验  
   • MIGRATION_GUIDE（v3→v4）、OpenRewrite 自动迁移脚本、常见问题 FAQ 均为空白，对外部用户不友好。  
   • Release Note 尚未锁定 breaking changes 与灰度开关的默认值。  

8. DevOps / CI 完善度  
   • GitHub Actions 中的缓存（Maven、Python）、失败报告上传、PR 评论机器人等细节脚本需要进一步打磨，确保流水线稳定、可读。  

9. 长期监控与可观测性  
   • Provider 调用次数、耗时、降级频率等运行时指标未进入观测体系；缺少 Prometheus/Micrometer 接入或日志埋点。  

10. 技术债与最佳实践差距  
    • OWASP 依赖扫描、突变测试（PIT）、覆盖率趋势图、自动版本语义化发布等仍在规划阶段。  

只要在下一阶段按优先级解决上述九大缺口，实码交付并跑通门禁、基准与文档，就能把整体可行性从 7.7 抬升到 9.5+；再补齐监控、安全与自动迁移工具等「锦上添花」项，即有机会达到满分 10 / 10。

---

_**User (2025-10-12 06:21Z)**_

下面是结合仓库现状，对 docs/task/v4.0.0/cards/claude 任务卡整体“操作可行性”的多维度评估与打分，并指出关键证据与落地阻力。

  总体结论

  - 总体可行性: 7.2/10（中高）
  - 成功前提: 先完成 SPI/ProviderRegistry 与 TFI 路由改造（01 + 02），再推进模块化与门禁。
  - 最大阻力: 目前为单模块+紧耦合 Spring 的门面实现；CI/CD 门禁与审批流缺失；ApprovalTests 与 jqwik 体系待引入。

  现状证据

  - 单模块工程，未分层/未拆多模块与 BOM：pom.xml:1
  - TFI 门面紧耦合 Spring 注入与兜底逻辑：src/main/java/com/syy/taskflowinsight/api/TFI.java:67, src/main/java/com/syy/taskflowinsight/api/TFI.java:83
  - CompareService 为 Spring Bean，但具备非 Spring 构造兜底：src/main/java/com/syy/taskflowinsight/tracking/compare/CompareService.java:33
  - JMH/bench 配置已存在（可用于性能基线）：pom.xml:316
  - Jacoco/SpotBugs/Checkstyle/PMD 已集成，但非严格门禁（failOnError/Violation 关闭；覆盖率阈值仅 50%）：pom.xml:296
  - 未发现 GitHub Actions 等 CI 流水线目录：.github

  多维度打分（1-10，高分代表更易落地）

  - 架构契合度: 6/10
      - 缺 SPI/ProviderRegistry 与多模块骨架；TFI 强 Spring 绑定（注入在 @Component 内部类）使 02/03 改造量大。证据：src/main/java/com/syy/taskflowinsight/api/TFI.java:67
  - 代码成熟度: 8/10
      - 域层丰富、API 与对比/追踪/渲染能力完善；大量测试覆盖支撑回归，但与 v4 目标的测试类型（Approval/jqwik）尚未接入。
  - 测试准备度: 7/10
      - JUnit 测试量大且细；缺 ApprovalTests、jqwik、ArchUnit。引入成本中等。
  - CI/CD 准备度: 4/10
      - 本地静态分析/覆盖率有，但门禁未严格；缺工作流与 release gates（japicmp/diff-coverage 等）串联。
  - 性能风险: 7/10
      - 路由引入微开销可控；有 JMH 基础可验证（bench profile）。证据：pom.xml:316
  - 安全/合规: 5/10
      - 未集成 license/security 扫描；可通过插件快速补齐（可行性中等）。
  - 变更风险控制: 6/10
      - 大规模路由/模块化改造易回归；需 FeatureFlag 灰度与 ApprovalTests Golden 护栏。
  - 工期可信度: 6/10
      - 文档估算偏理想化；结合现状建议整体+20% 缓冲（模块化与大规模重构引入不确定性）。
  - 文档与基线: 8/10
      - 任务卡与路线清晰；风险/验收标准较完整；README 导航明确。证据：docs/task/v4.0.0/cards/claude/README.md:1

  P0 关键卡片可行性速评

  - 01 SPI 与 ProviderRegistry: 7/10
      - 当前无 spi 包；但 CompareService/TFI 具兜底思路，有落地基础。首要卡片，完成后降低后续耦合风险。
  - 02 TFI 路由改造: 6/10
      - 影响面最大（40+ API），高回归风险；必须配套 FeatureFlag 与 Golden/属性测试。证据：src/main/java/com/syy/taskflowinsight/api/TFI.java:67
  - 03 多模块 + tfi-parent/bom: 5/10
      - 需要拆包与依赖边界收敛；建议在 01/02 稳定后推进。
  - 04 ArchUnit 依赖方向规则: 8/10
      - 易落地（测试级别）；可先行构建红线，促进 02/03 实施质量。
  - 05 japicmp 二进制兼容门禁: 6/10
      - 需准备 v3 基线产物与工作流；本地可先行验证。
  - 06 差异覆盖门禁 + CI: 6/10
      - 插件接入简单，但要与审批/发布流打通才形成“门禁”价值。
  - 07 ApprovalTests Golden: 5/10
      - 目标规模（2000 用例）较大；建议优先覆盖 02 改造的 20% 高风险 API，再扩面。
  - 09 基线采集与归档: 8/10
      - 直接复用 bench 配置，较易产出基线报告。证据：pom.xml:316
  - 13 发布关口与 Go/No-Go: 6/10
      - 需要 CI 流程承载多个门禁，依赖 04/05/06/07 的落地度。

  P1/P2 快速评估

  - 08 jqwik 属性测试: 8/10（易落地，补齐性质约束，强化 02 回归安全网）
  - 10 tfi-all 打包与体积: 6/10（需权衡 shading/多版本 JAR；待模块化）
  - 11 标准/完整性能基线: 8/10（现有 JMH 即插即用）
  - 12 api-spring + starter 自动装配: 7/10（与 03 强相关；拆分 starter 合理）
  - 14 风险仪表盘与告警: 6/10（Actuator/Micrometer 已有；需完善统一指标/阈值与仪表盘脚本）
  - 15 安全与许可证扫描: 7/10（插件化接入，门槛低）

  关键差距与落地建议

  - 缺失项与动作
      - 新增 spi 包与 ProviderRegistry（01 前置）；构建 NoOp/Default 实现以保障降级。
      - 为 TFI 增加路由开关（FeatureFlag），以灰度/回滚；先覆盖 compare/track 核心方法。
      - 引入 ArchUnit/ApprovalTests/jqwik 依赖与样例；优先围绕 02 的高风险方法建立 Golden。
      - 搭建最小 CI（GitHub Actions）并串起 jacoco-check、ArchUnit、japicmp、diff-coverage。
      - 用 bench profile 跑出 v3 基线，再做 v4 回归比对，出具文档归档。
  - 执行顺序（建议四步走）
      - M1: 01 + 04 + 最小 CI 骨架 → 建立“变更护栏”
      - M2: 02（分批方法）+ FeatureFlag + 少量 Golden → 可回滚可验证
      - M3: 03 + 12 → 模块化与 starter 化（此时 ArchUnit 约束已生效）
      - M4: 05/06/07/08/10/11/13/14/15 → 完整门禁与发布资产
  - 风险缓解
      - 大改动先在 compare/track 主路径做 route + Golden，逐步扩面（避免一次性 40 方法全量切换）
      - “先门禁、后重构”：先用 ArchUnit/ApprovalTests 限制退化，再推进 02/03
      - 建立“最小可用”工作流（unit + jacoco + archunit + smoke），再迭代 japicmp/diff-cov/性能基线

  与仓库规范对齐提醒

  - 当前 Checkstyle/PMD/SpotBugs 未启用失败门槛（pom.xml:200 附近配置），与规范“clean verify 强制通过”不一致；建议逐步收紧。
  - 规范提到 docs/architecture/README.md，但仓库无该文件；建议在推进 03 时补齐架构说明与模块边界图。

  需要我进一步细化某张卡（如 01 或 02）的实施清单与落地差距对照，或先起一个最小 CI 工作流样板吗？


› 改成成功率是多少


• - 总体成功率（按前述7.2/10换算）: 约 72%
  - 若先完成 01+02 并加最小CI与Golden护栏（分阶段推进）: 约 80%–85%

你怎么看

---

_**Assistant (o3)**_



---

我同意你给出的两个成功率区间，它们与当前仓库状态、任务拆分粒度以及团队常规交付效率大体吻合，但仍可再做以下微调和补充说明：

1. 72 % ≈ “全包并行推进”的现实概率  
   • 没有前置护栏（SPI/路由+CI）就直接做模块拆分、门禁与大规模重构，失误→回滚成本高，任何一个环节卡住就会拖慢整体节奏。  
   • 典型阻力：  
     – TFI 40 个 API 改造一次性合入，ApprovalTests 还没就位 → 回归难以量化  
     – ArchUnit / japicmp / diff‐cover 同期上线，首轮误报率通常 10 %–20 %  
   在这种打法下，七成左右的成功率属于偏乐观但仍可接受的粗估。

2. 80 %–85 % ≈ “分阶段递增护栏”的概率  
   前提：  
   a) 先落 01 SPI + ProviderRegistry（含简单 Unit + Chaos 测试）  
   b) 02 路由只改 **比较/追踪** 两大主流程的 8–12 个关键方法，并引入 FeatureFlag + 至少 60 个 ApprovalTests Golden  
   c) 最小 CI：JUnit + Jacoco check + ArchUnit（2 条规则）连通  
   这样可以把“可恢复性”“可观测性”指标提到一个安全水平，碰到回归时可以立刻回滚或定位。因此 80 %–85 % 的成功率较为稳妥。

3. 如何再向 90 %+ 抬升？  
   • **扩大 Golden 覆盖**：在比较、追踪稳定后再逐批对流程、渲染方法补齐 Golden+属性测试；目标 ≥ 50 % 路由方法都有 Golden。  
   • **渐进启用门禁**：ArchUnit 先启核心 2 条，再逐步增到 8 条；diff-cover 阈值先 70 %，两周后拉到 80 %。  
   • **CI 早期可“警告”模式**： japicmp/diff-cover 前两周仅注释 PR，不 fail job，让团队先熟悉报告格式。  
   • **风险演练**：上线前做一次 Chaos Suite（5 × 场景）在 CI 跑满；演练 FeatureFlag 回滚脚本。  
   差不多再提升 5–8 %的把握度，逼近 90 %。

4. 建议的成功率表达  
   • 现状直接 All-in：≈ 70 %  
   • 分阶段护栏打法：80 %–85 %（推荐）  
   • 护栏 + 渐进门禁 + 回滚演练：≈ 90 %  

综合来看，你的区间判断是合理的；若团队希望更接近满分成功率，就需要在“护栏→渐进门禁→演练”这条路线上多投入一两个冲刺，用时间换风险可控性。

---

_**User (2025-10-12 06:21Z)**_

那你评估下 是否值得粉模块化改造

---

_**Assistant (o3)**_



---

值得，但要“循序渐进、以收益驱动”。

一、收益（Why）  
1. 最小依赖：把纯 Java 核心（api-core / diff-core / tracking-core …）和 Spring-Bridge、Starter 剥离，可让 SDK 在 CLI、批处理、插件化场景直接使用，扩大用户面。  
2. 交付体积：用户只想要比较功能时，不必把 Flow/Render 之类一起打进包，Jar 大小可从 20 MB 降到 <5 MB。  
3. 质量栅栏：模块边界 + ArchUnit 规则等于把“追踪代码不许依赖 Spring”写进自动测试，长期防腐。  
4. 版本治理：BOM + parent 让三方库统一升级；未来发布补丁能只发受影响模块，降低回归风险。  
5. 商业灵活性：与商业插件（Flow Plus、Render Pro 等）拆分发行方便 License 控制。

二、成本与风险（What）  
1. 代码迁移：≈ 260 源文件需重定位包路径；IDE 批量 Refactor + 自动化脚本仍需 1～2 人周。  
2. 循环依赖：拆包易暴露隐含耦合（api ↔ tracking）；需要先抽公共 model 或 API。  
3. 发布脚本：Maven Reactor、GitHub Actions cache、deploy key 等 DevOps 配置要重写。  
4. 用户迁移：老工程 `compile "tfi:taskflowinsight:4.0.0"` 可能换成 `api-core`＋`starter` 两个依赖；需文档 + OpenRewrite recipe。  
5. 初期噪音：多模块后 IDE import 路径、包扫描、m²n test classpath 常见“小坑”，要留缓冲。

三、ROI 粗算（假设 2 sprint ≈ 4 周）  
• 研发与 DevOps 投入：≈ 25–30 人天  
• 每年节省／创造  
  – 更小发布工件 & 传输流量：~500 USD 云成本  
  – 客户使用非 Spring 场景新增 1–2 家（假设 ARR 1–2 万）  
  – 架构腐化 bug 减少 2～3 起 / 年（每起修复+停机 2 人天）  
加上长线品牌与维护成本下降，ROI ≥ 3:1，属于“中高收益”改造。

四、落地节奏（How）  
阶段 M-1（1 周）：  
• 搞定 tfi-parent / tfi-bom骨架 + api-core 空壳；跑 Maven Reactor 绿灯  
阶段 M-2（1 周）：  
• 迁移 SPI、ProviderRegistry、TFI（无 Spring 依赖）进 api-core  
• api-spring 模块只放 Spring-Bridge + starter  
阶段 M-3（≤2 周并行）：  
• diff-core / tracking-core / flow-core / render-md 拆分  
• ArchUnit BanCircularDependencies、生效 2 条核心规则  
• 灰度发布一个 RC 版，在现有集成测试跑全量回归  
阶段 M-4（收尾）：  
• 编写 MIGRATION_GUIDE & OpenRewrite recipe  
• 上 CI 门禁（japicmp + diff-coverage 聚合 + size check）

五、决策建议  
1. 若公司业务已在 SDK/CLI 场景落地或准备走插件市场 → 模块化属于 **必须做**。  
2. 若产品仍 100 % Spring-Boot SaaS，只求内部易维护 → 把 01/02 路由与 ArchUnit 做好即可，模块化可延后。  
3. 无论采纳与否，先把 SPI/路由打通（01/02）＋最小 ArchUnit 规则，是后续一切演进的“地基”。

总结  
• 模块化带来的长期收益（生态、扩展、质量堡垒）明显大于一次性投入。  
• 建议“先打地基→小步拆包→灰度验证”，在 2～3 冲刺内分阶段完成，ROI 合理，风险可管。

---

_**User (2025-10-12 06:21Z)**_

你是不是误解了 我想让你看下严格按照@claude/ 方案实施的风险有多大 不是已经已经按照这个方案实施过了

---

_**Assistant (o3)**_



---

下面给出“完全按照 docs/task/v4.0.0/cards/claude 系列卡片一步到位实施”时的风险矩阵与成因分析，并标注可能触发的连锁影响及缓解措施。风险分级采用常见 (概率 × 影响) 模型：  
H=高、M=中、L=低。

1. 大规模代码重构一次合并  
   • 影响：引入回归难以定位，可能阻断主线 (H)  
   • 触发点：卡片 01+02+03 同批 PR，40 个 TFI 方法路由、260+ 文件搬迁  
   • 缓解：分批 PR（比较→追踪→流程→渲染）、FeatureFlag 灰度、ApprovalTests 逐步扩面  

2. 模块拆分导致循环依赖或包名错位  
   • 影响：Reactor 构建失败、IDE 无法解析 (H)  
   • 触发点：api-core 需要 model，diff-core 需要 api-core，容易出现环形依赖  
   • 缓解：先落 ArchUnit BanCircularDependencies，提前生成 dependency-graph dot 图人工审查  

3. 门禁工具首次启用即“阻断构建”  
   • 影响：CI 长时间红灯，团队停工 (M)  
   • 触发点：同时打开 ArchUnit 8 条规则、japicmp、diff-cover 80 %  
   • 缓解：初期用 WARN 模式或降低阈值，留 1～2 周“噪音清洗期”，增设豁免白名单流程  

4. ApprovalTests / jqwik 用例产出不足  
   • 影响：功能回归仅靠手工验收，风险外溢 (M)  
   • 触发点：一次目标 2000 Golden，实则落地滞后  
   • 缓解：最先覆盖 compare/track 核心 happy-path，剩余 API 在后续迭代补齐；Golden 基线分阶段升级  

5. ServiceLoader 与 Spring Bean 冲突  
   • 影响：生产环境加载到意外 Provider，功能失效 (M)  
   • 触发点：Spring 环境下 ServiceLoader 仍起作用，priority 配置不当  
   • 缓解：在 Spring-Bridge 注入时显式把优先级设 200，并在 ProviderRegistry 打 INFO 日志列出最终决议  

6. CI/CD 生态复杂化  
   • 影响：新流水线（Python diff-cover、japicmp 下载旧版 Jar、JMH 基线）增加执行时间与维护面 (M)  
   • 缓解：拆分 job 并行执行；用 cache-action 缓存旧版 Jar 与 pip wheel；基线性能任务改为 nightly job  

7. 团队对新工具链生疏  
   • 影响：误报难判、时间消耗 (M)  
   • 缓解：提前办 1 次 2-h workshop；在 PR 模板附“常见 ArchUnit/japicmp 误报处理表”  

8. 客户升级阻力  
   • 影响：如果 v4.0.0 一经发布即强制模块化坐标，用户 POM 需改；潜在投诉 (L)  
   • 缓解：Starter 里保留与 v3 相同坐标的 tfi-all 聚合 Jar，Mark deprecated，留 1 个大版本兼容期  

9. 性能及包体指标未实测  
   • 影响：上线后 Jar 可能超 20 MB、lookup 慢于 1 µs，口碑受损 (L)  
   • 缓解：在实施顺序中插入卡片 11 (JMH 基线) 与 10 (size check) 并自动上传到 CI artifact  

10. 安全与合规延后  
    • 影响：license／漏洞扫描缺口窗口 (L)  
    • 缓解：卡片 15 其实一天即可接入（OWASP-dependency-check/Github SBOM），可并行提早完成  

综合判断  
• 若所有卡片一次性堆叠实施，连续 CI 红灯 + 业务代码冻结的风险高达 30–35 %。  
• 采用“护栏优先-分阶段”策略（见前文 M1-M4 节奏），高风险项 1 和 2 可降至中，整仓停摆概率可压到 <10 %。  
• 里程碑拆分不仅技术安全，也有助于团队逐步熟悉 japicmp / ArchUnit 等新工具，减少误报噪音。

因此，方案本身没有不可逾越的技术障碍；风险主要来自“过于激进的一次性重构 + 门禁齐开”。先以 SPI/路由为切入点、逐批引入门禁，将风险拆分到多个可回滚的小步里，是更务实的落地策略。

---

