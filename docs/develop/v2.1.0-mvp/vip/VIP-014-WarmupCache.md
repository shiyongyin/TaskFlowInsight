# VIP-014-WarmupCache（合并版）

## 1. 概述  
- 主题：缓存预热机制
- 源卡：
  - OPUS: `../../opus/PROMPT-M2M1-042-warmup-cache.md`
  - GPT: 无直接对应
- 相关代码：
  - `src/main/java/com/syy/taskflowinsight/warmup/CacheWarmup.java`（待创建）

## 2. 相同点（达成共识）
- 启动时预热
- 减少冷启动影响
- 可配置预热项
- 异步预热支持

## 3. 差异与歧义

### 差异#1：预热时机
- **影响**：启动性能

#### 现状 vs 规划 对照（速览）
- 现状（已实现）
  - 未提供启动预热机制。
- 规划（Phase 4）
  - 可配置的缓存预热列表与异步预热能力；在实际冷启动问题出现后再引入，以避免过早优化。

## 处置策略（MVP阶段）
- 不进行预热实现，先通过指标确认是否存在冷启动问题。
- 如果需要，优先在“热点路径”进行点状预热，控制预热时长与失败回退。

## 实施触发条件
- 冷启动 P95 > 2s 或首条业务路径超过 SLA（以产品定义为准）。
- 预热可显著降低首请求时延，且具备可控回退策略。
- **OPUS方案**：启动时同步预热
- **建议改进**：支持异步和延迟预热
- **理由**：避免阻塞启动

## 4. 最终设计（融合后）

### 接口与契约

实现示例：见 `snippets/VIP-014-WarmupCache-EXAMPLES.md#实现示例`


### 配置键

配置示例：见 `snippets/VIP-014-WarmupCache-EXAMPLES.md#配置示例（yaml）`


## 5. 验收与回滚

### 验收清单
- [ ] 预热不阻塞启动
- [ ] 缓存命中率提升
- [ ] 预热时间可控

### 回滚方案
1. 禁用预热：`tfi.warmup.enabled=false`

---
*生成时间：2024-01-12*
*版本：v2.1.0-MVP*
