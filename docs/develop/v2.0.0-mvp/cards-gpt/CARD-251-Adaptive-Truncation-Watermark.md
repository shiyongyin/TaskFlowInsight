Title: CARD-251 — 自适应截断与水位策略验证（推迟到 M1）

一、开发目标（M1）
- ☐ 明确定义水位口径（会话/全局变更条数占容量或存储占用比例）。
- ☐ 在高水位（>80% / >90%）时动态收紧截断（2048 / 512），回落后恢复。

二、开发清单
- ☐ 依赖变更存储/计数能力；实现水位检测与阈值切换策略。
- ☐ 记录 WARN 日志与简易指标；可配置阈值与降级策略。

三、测试要求
- ☐ 构造大量长 valueRepr 的变更，逼近/越过阈值，验证截断与恢复行为。

四、关键指标
- ☐ 无 OOM；吞吐未明显恶化；日志/指标可读。

五、验收标准
- ☐ 用例通过；策略参数可配置；输出稳定。

六、风险评估
- ☐ 无水位能力支撑时难以稳定复现：依赖 M1 的存储/计数实现。

七、核心技术设计（M1 预案）
- ☐ 水位定义：
  - ☐ 会话级：会话变更条数 / 会话容量上限；全局级：所有会话变更条数 / 全局容量上限。
- ☐ 降截策略：
  - ☐ >80% → 2048；>90% → 512；回落至 <70% 恢复默认 8192（带抖动区间）。
- ☐ 实施点：
  - ☐ Repr.repr(value,max) 的 `max` 由策略动态给出。

八、核心代码说明（骨架/伪码）
```java
public interface Watermark {
  int currentMaxLen();
}
class AdaptiveWatermark implements Watermark {
  public int currentMaxLen(){ double ratio = meter(); return ratio>0.9?512: ratio>0.8?2048:8192;}
}
```
