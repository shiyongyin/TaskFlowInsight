# ğŸ“‹ TaskFlow Insight (TFI) äº§å“éœ€æ±‚æ–‡æ¡£

**ç‰ˆæœ¬**: v1.0.0  
**æ—¥æœŸ**: 2024å¹´12æœˆ  
**çŠ¶æ€**: Draft  
**ä½œè€…**: Product Team  

---

## ä¸€ã€äº§å“æ¦‚è¿°

### 1.1 äº§å“å®šä½

**TaskFlow Insight** æ˜¯ä¸€ä¸ªå¼€æºçš„Javaåº”ç”¨æ€§èƒ½åˆ†æå·¥å…·ï¼Œé€šè¿‡æ„å»ºå¤šå±‚åµŒå¥—çš„ä»»åŠ¡æ ‘å½¢æ¨¡å‹ï¼Œæä¾›ä»£ç æ‰§è¡Œæµç¨‹çš„æ·±åº¦æ´å¯Ÿèƒ½åŠ›ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®šä½æ€§èƒ½ç“¶é¢ˆã€ç†è§£ä¸šåŠ¡æµç¨‹ã€è¿½è¸ªçŠ¶æ€å˜æ›´ã€‚

### 1.2 äº§å“æ„¿æ™¯

> "è®©æ¯ä¸€è¡Œä»£ç çš„æ‰§è¡Œè¿‡ç¨‹éƒ½æ¸…æ™°å¯è§ï¼Œè®©æ¯ä¸€ä¸ªæ€§èƒ½é—®é¢˜éƒ½æ— å¤„éå½¢ã€‚"

### 1.3 ç›®æ ‡ç”¨æˆ·

| ç”¨æˆ·ç±»å‹ | ä¼˜å…ˆçº§ | ç”¨æˆ·ç”»åƒ | æ ¸å¿ƒè¯‰æ±‚ |
|---------|--------|---------|---------|
| **Javaåç«¯å¼€å‘è€…** | P0 | 3-5å¹´ç»éªŒï¼Œå¤„ç†å¤æ‚ä¸šåŠ¡é€»è¾‘ | å¿«é€Ÿå®šä½æ€§èƒ½é—®é¢˜ï¼Œç†è§£ä»£ç æ‰§è¡Œæµç¨‹ |
| **æŠ€æœ¯æ¶æ„å¸ˆ** | P1 | 5å¹´+ç»éªŒï¼Œè´Ÿè´£ç³»ç»Ÿä¼˜åŒ– | ç³»ç»Ÿæ€§èƒ½åˆ†æï¼Œæ¶æ„ä¼˜åŒ–å†³ç­– |
| **æ–°å…¥èŒå¼€å‘è€…** | P1 | 1å¹´ä»¥ä¸‹ï¼Œå­¦ä¹ ç°æœ‰ç³»ç»Ÿ | å¿«é€Ÿç†è§£ä¸šåŠ¡æµç¨‹ï¼Œé™ä½å­¦ä¹ æˆæœ¬ |
| **QAå·¥ç¨‹å¸ˆ** | P2 | è´Ÿè´£æ€§èƒ½æµ‹è¯• | æ€§èƒ½æµ‹è¯•æŠ¥å‘Šï¼Œé—®é¢˜å®šä½ |

### 1.4 æ ¸å¿ƒä»·å€¼ä¸»å¼ 

- **å¯è§†åŒ–æ‰§è¡Œæµç¨‹**ï¼šå°†å¤æ‚çš„æ–¹æ³•è°ƒç”¨è½¬åŒ–ä¸ºç›´è§‚çš„æ ‘å½¢ç»“æ„
- **ç²¾ç¡®æ€§èƒ½åˆ†æ**ï¼šä¸åªæ˜¯è®¡æ—¶ï¼Œæ›´ç†è§£æ—¶é—´éƒ½èŠ±åœ¨å“ªé‡Œ
- **å˜æ›´è¿½è¸ªèƒ½åŠ›**ï¼šè‡ªåŠ¨è®°å½•å…³é”®å¯¹è±¡çš„çŠ¶æ€å˜åŒ–
- **é›¶ä¾µå…¥é›†æˆ**ï¼šé€šè¿‡æ³¨è§£æˆ–AOPï¼Œæœ€å°åŒ–ä»£ç æ”¹åŠ¨

## äºŒã€ä¸šåŠ¡èƒŒæ™¯

### 2.1 å¸‚åœºç°çŠ¶

```yaml
ç°æœ‰è§£å†³æ–¹æ¡ˆçš„ä¸è¶³ï¼š
- APMå·¥å…·ï¼šåŠŸèƒ½å¼ºå¤§ä½†ä»·æ ¼æ˜‚è´µï¼Œè¿‡äºå¤æ‚
- æ—¥å¿—åˆ†æï¼šä¿¡æ¯æ•£ä¹±ï¼Œéš¾ä»¥å½¢æˆå…¨å±€è§†å›¾  
- Profilerï¼šä¸“ä¸šæ€§å¤ªå¼ºï¼Œå­¦ä¹ æ›²çº¿é™¡å³­
- è°ƒè¯•å™¨ï¼šåªé€‚åˆå¼€å‘ç¯å¢ƒï¼Œæ— æ³•ç”¨äºç”Ÿäº§

å¸‚åœºæœºä¼šï¼š
- ç¼ºå°‘ä¸“æ³¨äºä¸šåŠ¡æµç¨‹åˆ†æçš„å·¥å…·
- å¼€æºé¢†åŸŸç¼ºå°‘æ˜“ç”¨çš„æ€§èƒ½åˆ†æå·¥å…·
- å˜æ›´è¿½è¸ªæ˜¯æœªè¢«æ»¡è¶³çš„éœ€æ±‚
```

### 2.2 ç”¨æˆ·ç—›ç‚¹

1. **æ€§èƒ½é—®é¢˜å®šä½å›°éš¾**
   - "ç³»ç»Ÿå¾ˆæ…¢ï¼Œä½†ä¸çŸ¥é“æ…¢åœ¨å“ªé‡Œ"
   - "æ—¥å¿—å¤ªå¤šï¼Œæ‰¾ä¸åˆ°å…³é”®ä¿¡æ¯"

2. **å¤æ‚æµç¨‹ç†è§£å›°éš¾**
   - "è¿™ä¸ªè®¢å•å¤„ç†æ¶‰åŠå‡ åä¸ªæ–¹æ³•ï¼Œæä¸æ¸…æ¥šè°ƒç”¨å…³ç³»"
   - "æ–°äººè¦èŠ±å‡ å‘¨æ‰èƒ½ç†è§£æ ¸å¿ƒä¸šåŠ¡æµç¨‹"

3. **çŠ¶æ€å˜æ›´è¿½è¸ªå›°éš¾**
   - "ä¸çŸ¥é“æ•°æ®æ˜¯åœ¨å“ªä¸€æ­¥è¢«ä¿®æ”¹çš„"
   - "å¹¶å‘åœºæ™¯ä¸‹çš„çŠ¶æ€å˜æ›´æ— æ³•è¿½è¸ª"

### 2.3 ç«å“åˆ†æ

| äº§å“ | ä¼˜åŠ¿ | åŠ£åŠ¿ | TFIçš„å·®å¼‚åŒ– |
|------|------|------|------------|
| SkyWalking | å®Œæ•´çš„APMåŠŸèƒ½ | éƒ¨ç½²å¤æ‚ï¼Œé‡é‡çº§ | è½»é‡çº§ï¼Œä¸“æ³¨ä¸šåŠ¡ |
| Arthas | å¼ºå¤§çš„è¯Šæ–­èƒ½åŠ› | å‘½ä»¤è¡Œæ“ä½œï¼Œå­¦ä¹ æˆæœ¬é«˜ | GUIå‹å¥½ï¼Œè‡ªåŠ¨åŒ– |
| JProfiler | ä¸“ä¸šçš„æ€§èƒ½åˆ†æ | æ”¶è´¹ï¼Œè¿‡äºä¸“ä¸š | å¼€æºå…è´¹ï¼Œæ˜“ç”¨ |
| æ—¥å¿—æ¡†æ¶ | ç®€å•ï¼Œæ™®åŠåº¦é«˜ | ç¼ºå°‘ç»“æ„åŒ–ï¼Œåˆ†æå›°éš¾ | ç»“æ„åŒ–æ ‘å½¢æ¨¡å‹ |

## ä¸‰ã€äº§å“åŠŸèƒ½è§„åˆ’

### 3.1 åŠŸèƒ½æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  åº”ç”¨å±‚ Application                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                é›†æˆå±‚ Integration                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Spring   â”‚   æ³¨è§£    â”‚   AOP    â”‚  Manual API â”‚ â”‚
â”‚  â”‚ Boot     â”‚ @TFITask â”‚  Aspect  â”‚   TFI.*     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              æ ¸å¿ƒå¼•æ“ Core Engine                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Task    â”‚  Timer   â”‚  Tree    â”‚   Thread    â”‚ â”‚
â”‚  â”‚ Manager  â”‚  Engine  â”‚ Builder  â”‚   Manager   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚            æ•°æ®å¤„ç† Data Processing                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚Performanceâ”‚  Flow    â”‚  Change  â”‚  Exception  â”‚ â”‚
â”‚  â”‚Collector â”‚Collector â”‚ Tracker  â”‚  Handler    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              åˆ†æå¼•æ“ Analyzers                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Time    â”‚ Memory   â”‚Bottleneckâ”‚  Pattern    â”‚ â”‚
â”‚  â”‚ Analyzer â”‚ Analyzer â”‚ Analyzer â”‚  Analyzer   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚               è¾“å‡ºå±‚ Reporters                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Console  â”‚   HTML   â”‚   JSON   â”‚   Metrics   â”‚ â”‚
â”‚  â”‚ Reporter â”‚ Reporter â”‚ Reporter â”‚  Exporter   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ ¸å¿ƒåŠŸèƒ½æ¸…å•

#### 3.2.1 P0åŠŸèƒ½ï¼ˆMVPå¿…é¡»ï¼‰

##### F001: ä»»åŠ¡æ ‘å½¢æ¨¡å‹æ„å»º
```yaml
åŠŸèƒ½æè¿°: è‡ªåŠ¨æ„å»ºå¤šå±‚åµŒå¥—çš„ä»»åŠ¡æ‰§è¡Œæ ‘
æ¥å—æ ‡å‡†:
  - æ”¯æŒçˆ¶å­ä»»åŠ¡å…³ç³»
  - æ”¯æŒæœ€å¤š100å±‚åµŒå¥—
  - æ”¯æŒå¹¶è¡Œä»»åŠ¡è¡¨ç¤º
  - çº¿ç¨‹å®‰å…¨

APIç¤ºä¾‹:
  TaskContext task = TFI.start("parentTask");
  TaskContext subTask = TFI.start("subTask");
  TFI.stop(); // è‡ªåŠ¨å»ºç«‹çˆ¶å­å…³ç³»
  TFI.stop();
```

##### F002: å¤šçº¿ç¨‹ä»»åŠ¡éš”ç¦»
```yaml
åŠŸèƒ½æè¿°: æ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹ç»´æŠ¤ä»»åŠ¡æ ‘ï¼Œäº’ä¸å¹²æ‰°
æ¥å—æ ‡å‡†:
  - ThreadLocalå®ç°çº¿ç¨‹éš”ç¦»
  - æ”¯æŒçº¿ç¨‹æ± åœºæ™¯
  - æ”¯æŒå¼‚æ­¥ä»»åŠ¡è¿½è¸ª
  - å†…å­˜è‡ªåŠ¨æ¸…ç†

æŠ€æœ¯æ–¹æ¡ˆ:
  - ä½¿ç”¨ThreadLocalå­˜å‚¨ä»»åŠ¡æ ˆ
  - ä½¿ç”¨WeakReferenceé˜²æ­¢å†…å­˜æ³„æ¼
  - æä¾›æ‰‹åŠ¨æ¸…ç†æ¥å£
```

##### F003: æ‰§è¡Œæ—¶é—´ç»Ÿè®¡
```yaml
åŠŸèƒ½æè¿°: ç²¾ç¡®ç»Ÿè®¡æ¯ä¸ªä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´
æ¥å—æ ‡å‡†:
  - çº³ç§’çº§ç²¾åº¦
  - æ”¯æŒæš‚åœ/æ¢å¤è®¡æ—¶
  - è‡ªåŠ¨è®¡ç®—ç´¯è®¡æ—¶é—´
  - ç™¾åˆ†æ¯”åˆ†æ

è¾“å‡ºæ ¼å¼:
  processOrder (245ms, 100%)
  â”œâ”€â”€ validate (12ms, 4.9%)
  â”œâ”€â”€ calculate (180ms, 73.5%)
  â””â”€â”€ save (53ms, 21.6%)
```

##### F004: åŸºç¡€æ³¨è§£æ”¯æŒ
```yaml
åŠŸèƒ½æè¿°: é€šè¿‡æ³¨è§£è‡ªåŠ¨è¿½è¸ªæ–¹æ³•æ‰§è¡Œ
æ¥å—æ ‡å‡†:
  - @TFITaskæ³¨è§£
  - è‡ªåŠ¨æ–¹æ³•æ‹¦æˆª
  - å‚æ•°è®°å½•å¯é€‰
  - è¿”å›å€¼è®°å½•å¯é€‰

ç¤ºä¾‹ä»£ç :
  @TFITask("processOrder")
  public Order process(OrderRequest req) {
      // è‡ªåŠ¨è¿½è¸ª
  }
```

##### F005: æ§åˆ¶å°è¾“å‡º
```yaml
åŠŸèƒ½æè¿°: æ ‘å½¢ç»“æ„çš„æ§åˆ¶å°è¾“å‡º
æ¥å—æ ‡å‡†:
  - ASCIIæ ‘å½¢å›¾
  - é¢œè‰²é«˜äº®ï¼ˆå¯é€‰ï¼‰
  - è‡ªå®šä¹‰ç¼©è¿›
  - ä¿¡æ¯å¯†åº¦å¯æ§

è¾“å‡ºç¤ºä¾‹:
  processOrder (245ms)
  â”œâ”€â”€ validateOrder (12ms)
  â”‚   â””â”€â”€ checkInventory (8ms)
  â””â”€â”€ calculatePrice (45ms)
      â”œâ”€â”€ getDiscount (30ms)
      â””â”€â”€ applyTax (15ms)
```

#### 3.2.2 P1åŠŸèƒ½ï¼ˆæ ¸å¿ƒå¢å¼ºï¼‰

##### F006: å¯¹è±¡å˜æ›´è¿½è¸ª
```yaml
åŠŸèƒ½æè¿°: è‡ªåŠ¨è¿½è¸ªå¯¹è±¡å±æ€§çš„å˜åŒ–
æ¥å—æ ‡å‡†:
  - æ”¯æŒæ·±å±‚å±æ€§è¿½è¸ª
  - æ”¯æŒé›†åˆå˜æ›´
  - å˜æ›´æ—¶é—´è®°å½•
  - å˜æ›´åŸå› å…³è”

APIç¤ºä¾‹:
  TFI.trackChange(order, "status", "amount");
  
è¾“å‡ºç¤ºä¾‹:
  Changes in processOrder:
  â””â”€â”€ Order.status: NEW â†’ CONFIRMED (12ms)
  â””â”€â”€ Order.amount: 0 â†’ 1234.56 (45ms)
```

##### F007: ä¸šåŠ¡æµç¨‹è®°å½•
```yaml
åŠŸèƒ½æè¿°: è®°å½•ä¸šåŠ¡æ‰§è¡Œçš„å…³é”®å†³ç­–ç‚¹
æ¥å—æ ‡å‡†:
  - æ¡ä»¶åˆ†æ”¯è®°å½•
  - å¾ªç¯æ¬¡æ•°ç»Ÿè®¡
  - å¼‚å¸¸è·¯å¾„è®°å½•
  - è‡ªå®šä¹‰æ£€æŸ¥ç‚¹

APIç¤ºä¾‹:
  TFI.checkpoint("åº“å­˜æ£€æŸ¥é€šè¿‡");
  TFI.decision("æŠ˜æ‰£ç­–ç•¥", "VIPç”¨æˆ·");
  TFI.loop("è®¢å•é¡¹å¤„ç†", items.size());
```

##### F008: HTMLæŠ¥å‘Šç”Ÿæˆ
```yaml
åŠŸèƒ½æè¿°: ç”Ÿæˆå¯äº¤äº’çš„HTMLæŠ¥å‘Š
æ¥å—æ ‡å‡†:
  - æ ‘å½¢å›¾å¯å±•å¼€/æŠ˜å 
  - æ€§èƒ½çƒ­ç‚¹é«˜äº®
  - æ—¶é—´è½´è§†å›¾
  - æœç´¢å’Œè¿‡æ»¤

æŠ€æœ¯æ–¹æ¡ˆ:
  - ä½¿ç”¨D3.jsç»˜åˆ¶æ ‘å½¢å›¾
  - ä½¿ç”¨Chart.jsç»˜åˆ¶å›¾è¡¨
  - å•æ–‡ä»¶HTMLè¾“å‡º
```

##### F009: Spring Boot Starter
```yaml
åŠŸèƒ½æè¿°: Spring Bootè‡ªåŠ¨é…ç½®
æ¥å—æ ‡å‡†:
  - è‡ªåŠ¨é…ç½®
  - é…ç½®æ–‡ä»¶æ”¯æŒ
  - Actuatoré›†æˆ
  - æ¡ä»¶å¯ç”¨

é…ç½®ç¤ºä¾‹:
  tfi:
    enabled: true
    auto-track: true
    output: console,html
    threshold: 100ms
```

##### F010: æ€§èƒ½ç“¶é¢ˆåˆ†æ
```yaml
åŠŸèƒ½æè¿°: è‡ªåŠ¨è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ
æ¥å—æ ‡å‡†:
  - è‡ªåŠ¨æ ‡è®°æ…¢ä»»åŠ¡
  - å…³é”®è·¯å¾„åˆ†æ
  - TOP Næ…¢æ–¹æ³•
  - ä¼˜åŒ–å»ºè®®

åˆ†æç»“æœ:
  Bottlenecks Found:
  1. fetchDiscounts (150ms, 61.2%)
  2. saveToDatabase (89ms, 36.3%)
  Critical Path: A â†’ B â†’ D â†’ F
```

#### 3.2.3 P2åŠŸèƒ½ï¼ˆé«˜çº§ç‰¹æ€§ï¼‰

##### F011: å†…å­˜ä½¿ç”¨åˆ†æ
```yaml
åŠŸèƒ½æè¿°: åˆ†æä»»åŠ¡æ‰§è¡Œçš„å†…å­˜å½±å“
æ¥å—æ ‡å‡†:
  - å †å†…å­˜ä½¿ç”¨ç»Ÿè®¡
  - å¯¹è±¡åˆ›å»ºç»Ÿè®¡
  - GCå½±å“åˆ†æ
  - å†…å­˜æ³„æ¼æ£€æµ‹
```

##### F012: åˆ†å¸ƒå¼è¿½è¸ªé›†æˆ
```yaml
åŠŸèƒ½æè¿°: ä¸OpenTelemetryé›†æˆ
æ¥å—æ ‡å‡†:
  - TraceIdå…³è”
  - SpanIdæ˜ å°„
  - è·¨æœåŠ¡è¿½è¸ª
  - æ ‡å‡†åŒ–è¾“å‡º
```

##### F013: å®æ—¶ç›‘æ§Dashboard
```yaml
åŠŸèƒ½æè¿°: Webå®æ—¶ç›‘æ§ç•Œé¢
æ¥å—æ ‡å‡†:
  - WebSocketå®æ—¶æ¨é€
  - å†å²æ•°æ®æŸ¥è¯¢
  - å¤šç»´åº¦ç­›é€‰
  - å‘Šè­¦è®¾ç½®
```

##### F014: æ’ä»¶ä½“ç³»
```yaml
åŠŸèƒ½æè¿°: æ”¯æŒè‡ªå®šä¹‰æ‰©å±•
æ¥å—æ ‡å‡†:
  - é‡‡é›†å™¨æ’ä»¶
  - åˆ†æå™¨æ’ä»¶
  - è¾“å‡ºå™¨æ’ä»¶
  - æ’ä»¶å¸‚åœº
```

### 3.3 åŠŸèƒ½ä¼˜å…ˆçº§çŸ©é˜µ

| åŠŸèƒ½ç±»åˆ« | P0 (MVP) | P1 (v1.0) | P2 (Future) |
|---------|----------|-----------|-------------|
| **æ ¸å¿ƒ** | æ ‘å½¢æ¨¡å‹<br/>å¤šçº¿ç¨‹éš”ç¦»<br/>æ—¶é—´ç»Ÿè®¡ | ç“¶é¢ˆåˆ†æ<br/>å…³é”®è·¯å¾„ | é¢„æµ‹åˆ†æ |
| **é‡‡é›†** | åŸºç¡€æ³¨è§£<br/>æ‰‹åŠ¨API | AOPå¢å¼º<br/>æ‰¹é‡è¿½è¸ª | Agentæ¨¡å¼ |
| **åˆ†æ** | è€—æ—¶åˆ†æ | å˜æ›´è¿½è¸ª<br/>æµç¨‹è®°å½• | å†…å­˜åˆ†æ<br/>CPUåˆ†æ |
| **è¾“å‡º** | æ§åˆ¶å° | HTMLæŠ¥å‘Š<br/>JSON | Dashboard<br/>Metrics |
| **é›†æˆ** | ç‹¬ç«‹ä½¿ç”¨ | Spring Boot | åˆ†å¸ƒå¼è¿½è¸ª<br/>APMé›†æˆ |

## å››ã€éåŠŸèƒ½æ€§éœ€æ±‚

### 4.1 æ€§èƒ½è¦æ±‚

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹é‡æ–¹æ³• |
|------|--------|----------|
| **å¯åŠ¨å¼€é”€** | <100ms | å†·å¯åŠ¨æ—¶é—´ |
| **è¿è¡Œå¼€é”€** | <5% CPU | å‹æµ‹å¯¹æ¯” |
| **å†…å­˜å ç”¨** | <50MB | å †å†…å­˜å¢é‡ |
| **ä»»åŠ¡å®¹é‡** | 10000/çº¿ç¨‹ | å‹åŠ›æµ‹è¯• |

### 4.2 å¯ç”¨æ€§è¦æ±‚

```yaml
æ˜“ç”¨æ€§:
  - 5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹
  - é»˜è®¤é…ç½®å³å¯ç”¨
  - é”™è¯¯ä¿¡æ¯å‹å¥½
  - æ–‡æ¡£å®Œæ•´æ¸…æ™°

å…¼å®¹æ€§:
  - JDK 8+
  - Spring Boot 2.x/3.x
  - ä¸»æµIDEæ”¯æŒ
  - CI/CDé›†æˆ

ç¨³å®šæ€§:
  - å•å…ƒæµ‹è¯•è¦†ç›–ç‡ >80%
  - é›†æˆæµ‹è¯•è¦†ç›–æ ¸å¿ƒåœºæ™¯
  - æ— å†…å­˜æ³„æ¼
  - çº¿ç¨‹å®‰å…¨
```

### 4.3 æ‰©å±•æ€§è¦æ±‚

```yaml
æ¶æ„æ‰©å±•æ€§:
  - æ¨¡å—åŒ–è®¾è®¡
  - æ’ä»¶åŒ–æ¶æ„
  - SPIæœºåˆ¶
  - é…ç½®å¤–éƒ¨åŒ–

åŠŸèƒ½æ‰©å±•æ€§:
  - è‡ªå®šä¹‰é‡‡é›†å™¨
  - è‡ªå®šä¹‰åˆ†æå™¨
  - è‡ªå®šä¹‰è¾“å‡ºæ ¼å¼
  - è‡ªå®šä¹‰å­˜å‚¨
```

## äº”ã€æŠ€æœ¯æ¶æ„è®¾è®¡

### 5.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Application Code                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    TFI Integration Layer                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚Annotationâ”‚  AOP   â”‚ Manual API   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         TFI Core Engine                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Task    â”‚ Timer  â”‚   Tree       â”‚  â”‚
â”‚  â”‚ Manager  â”‚ Engine â”‚  Builder     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Data Processing                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚Collectorsâ”‚Analyzersâ”‚ Reporters   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Storage Layer                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Memory   â”‚ File   â”‚  Database    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 æ ¸å¿ƒç±»è®¾è®¡

```java
// æ ¸å¿ƒæ¥å£
public interface TaskContext {
    String getTaskId();
    String getTaskName();
    long getStartTime();
    long getDuration();
    TaskContext getParent();
    List<TaskContext> getChildren();
    Map<String, Object> getMetrics();
    List<ChangeRecord> getChanges();
}

// ä»»åŠ¡ç®¡ç†å™¨
public class TaskManager {
    public TaskContext start(String taskName);
    public void stop();
    public void stop(TaskContext context);
    public TaskTree getTaskTree();
    public void clear();
}

// å˜æ›´è®°å½•
public class ChangeTracker {
    public void track(Object target, String... fields);
    public List<ChangeRecord> getChanges();
    public void startTracking();
    public void stopTracking();
}

// æŠ¥å‘Šç”Ÿæˆå™¨
public interface Reporter {
    void report(TaskTree tree);
    String getFormat();
    boolean isEnabled();
}
```

### 5.3 æ•°æ®æ¨¡å‹

```java
// ä»»åŠ¡èŠ‚ç‚¹
@Data
public class TaskNode {
    private String taskId;
    private String taskName;
    private long startTime;
    private long endTime;
    private long duration;
    private TaskNode parent;
    private List<TaskNode> children;
    private Map<String, Object> attributes;
    private List<ChangeRecord> changes;
    private List<String> messages;
    private TaskStatus status;
    private Thread thread;
}

// å˜æ›´è®°å½•
@Data
public class ChangeRecord {
    private String objectId;
    private String objectType;
    private String fieldPath;
    private Object oldValue;
    private Object newValue;
    private long timestamp;
    private String taskId;
    private ChangeType changeType;
}

// æ€§èƒ½æŒ‡æ ‡
@Data
public class PerformanceMetrics {
    private long totalTime;
    private long selfTime;
    private long childrenTime;
    private double percentage;
    private int callCount;
    private long avgTime;
    private long minTime;
    private long maxTime;
}
```

## å…­ã€å®æ–½è®¡åˆ’

### 6.1 ç‰ˆæœ¬è§„åˆ’

#### v0.1.0 (MVP) - 4å‘¨
```yaml
ç›®æ ‡: æ ¸å¿ƒåŠŸèƒ½å¯ç”¨ï¼Œå¼€æºå‘å¸ƒ
åŠŸèƒ½:
  - ä»»åŠ¡æ ‘å½¢æ¨¡å‹
  - åŸºç¡€è®¡æ—¶åŠŸèƒ½
  - æ§åˆ¶å°è¾“å‡º
  - æ‰‹åŠ¨API
äº¤ä»˜ç‰©:
  - æºä»£ç 
  - READMEæ–‡æ¡£
  - å¿«é€Ÿå¼€å§‹æŒ‡å—
```

#### v0.5.0 (Beta) - 8å‘¨
```yaml
ç›®æ ‡: åŠŸèƒ½å®Œå–„ï¼Œç¤¾åŒºåé¦ˆ
åŠŸèƒ½:
  - æ³¨è§£æ”¯æŒ
  - Spring Boot Starter
  - HTMLæŠ¥å‘Š
  - å˜æ›´è¿½è¸ª
äº¤ä»˜ç‰©:
  - Mavenä¸­å¤®ä»“åº“å‘å¸ƒ
  - å®Œæ•´æ–‡æ¡£
  - ç¤ºä¾‹é¡¹ç›®
```

#### v1.0.0 (GA) - 12å‘¨
```yaml
ç›®æ ‡: ç”Ÿäº§å°±ç»ªï¼Œç¨³å®šå¯é 
åŠŸèƒ½:
  - æ€§èƒ½ä¼˜åŒ–
  - ç“¶é¢ˆåˆ†æ
  - æ’ä»¶ä½“ç³»
  - ç›‘æ§é›†æˆ
äº¤ä»˜ç‰©:
  - æ€§èƒ½æµ‹è¯•æŠ¥å‘Š
  - æœ€ä½³å®è·µæŒ‡å—
  - è§†é¢‘æ•™ç¨‹
```

### 6.2 å¼€å‘æ—¶é—´çº¿

```
2024 Q1 Timeline
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Week 1-2:   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ æ ¸å¿ƒå¼•æ“å¼€å‘
Week 3:     â–ˆâ–ˆâ–ˆâ–ˆ åŸºç¡€åŠŸèƒ½å®ç°  
Week 4:     â–ˆâ–ˆâ–ˆâ–ˆ æ–‡æ¡£ç¼–å†™ & MVPå‘å¸ƒ
Week 5-6:   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ æ³¨è§£æ”¯æŒ
Week 7-8:   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ Springé›†æˆ
Week 9:     â–ˆâ–ˆâ–ˆâ–ˆ HTMLæŠ¥å‘Š
Week 10-11: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ æ€§èƒ½ä¼˜åŒ–
Week 12:    â–ˆâ–ˆâ–ˆâ–ˆ GAç‰ˆæœ¬å‘å¸ƒ
```

## ä¸ƒã€æˆåŠŸæŒ‡æ ‡

### 7.1 äº§å“æŒ‡æ ‡

| é˜¶æ®µ | æŒ‡æ ‡ | ç›®æ ‡å€¼ |
|------|------|--------|
| MVP (1æœˆ) | GitHub Stars | 100 |
| | æ´»è·ƒç”¨æˆ· | 10 |
| Beta (3æœˆ) | GitHub Stars | 500 |
| | è´¡çŒ®è€… | 5 |
| | å‘¨ä¸‹è½½é‡ | 100 |
| GA (6æœˆ) | GitHub Stars | 2000 |
| | è´¡çŒ®è€… | 20 |
| | å‘¨ä¸‹è½½é‡ | 1000 |
| | ä¼ä¸šç”¨æˆ· | 10 |

### 7.2 æŠ€æœ¯æŒ‡æ ‡

```yaml
ä»£ç è´¨é‡:
  - æµ‹è¯•è¦†ç›–ç‡: >80%
  - ä»£ç å¤æ‚åº¦: <10
  - Bugå¯†åº¦: <5/KLOC
  - æ–‡æ¡£è¦†ç›–ç‡: 100%

æ€§èƒ½æŒ‡æ ‡:
  - å¯åŠ¨æ—¶é—´: <100ms
  - è¿è¡Œå¼€é”€: <5%
  - å†…å­˜å ç”¨: <50MB
  - æ”¯æŒå¹¶å‘: >1000
```

## å…«ã€é£é™©ç®¡ç†

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| æ€§èƒ½å¼€é”€è¿‡å¤§ | ä¸­ | é«˜ | é‡‡æ ·æœºåˆ¶ã€å¼‚æ­¥å¤„ç† |
| ç”¨æˆ·é‡‡ç”¨ç‡ä½ | ä¸­ | é«˜ | åŠ å¼ºæ¨å¹¿ã€é™ä½é—¨æ§› |
| æŠ€æœ¯å®ç°å›°éš¾ | ä½ | ä¸­ | æŠ€æœ¯é¢„ç ”ã€MVPéªŒè¯ |
| ç»´æŠ¤æˆæœ¬é«˜ | ä¸­ | ä¸­ | è‡ªåŠ¨åŒ–æµ‹è¯•ã€ç¤¾åŒºè´¡çŒ® |
| ä¸ç°æœ‰å·¥å…·å†²çª | ä½ | ä½ | å…¼å®¹æ€§æµ‹è¯•ã€é…ç½®éš”ç¦» |

## ä¹ã€èµ„æºéœ€æ±‚

### 9.1 äººåŠ›èµ„æº
```yaml
å¼€å‘å›¢é˜Ÿ:
  - æ ¸å¿ƒå¼€å‘: 1-2äºº
  - æ–‡æ¡£æ’°å†™: å…¼èŒ
  - æµ‹è¯•: å…¼èŒ
  - è®¾è®¡: æŒ‰éœ€

æ—¶é—´æŠ•å…¥:
  - MVPé˜¶æ®µ: å…¨èŒ1äººæœˆ
  - Betaé˜¶æ®µ: å…¨èŒ2äººæœˆ  
  - GAé˜¶æ®µ: å…¨èŒ2äººæœˆ
  - ç»´æŠ¤é˜¶æ®µ: æ¯å‘¨10å°æ—¶
```

### 9.2 åŸºç¡€è®¾æ–½
```yaml
å¼€å‘ç¯å¢ƒ:
  - GitHubä»“åº“
  - CI/CD (GitHub Actions)
  - Mavenä¸­å¤®ä»“åº“è´¦å·
  
æ¨å¹¿èµ„æº:
  - æŠ€æœ¯åšå®¢å¹³å°è´¦å·
  - ç¤¾äº¤åª’ä½“è´¦å·
  - åŸŸå (å¯é€‰)
```

## åã€é™„å½•

### 10.1 ç”¨æˆ·æ•…äº‹ç¤ºä¾‹

```gherkin
Feature: æ€§èƒ½é—®é¢˜å®šä½

Scenario: å¼€å‘è€…å®šä½æ…¢æ¥å£
  Given æˆ‘æœ‰ä¸€ä¸ªå“åº”ç¼“æ…¢çš„RESTæ¥å£
  When æˆ‘ä½¿ç”¨@TFITaskæ³¨è§£æ ‡è®°å…³é”®æ–¹æ³•
  And æˆ‘å‘èµ·ä¸€æ¬¡è¯·æ±‚
  Then æˆ‘èƒ½çœ‹åˆ°æ ‘å½¢çš„æ‰§è¡Œæµç¨‹
  And æˆ‘èƒ½è¯†åˆ«å‡ºæœ€è€—æ—¶çš„æ–¹æ³•
  And æˆ‘èƒ½çœ‹åˆ°è¯¥æ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°å’Œå¹³å‡è€—æ—¶
```

### 10.2 APIä½¿ç”¨ç¤ºä¾‹

```java
// 1. æœ€ç®€å•çš„ä½¿ç”¨
public void businessMethod() {
    TFI.start("businessProcess");
    try {
        // ä¸šåŠ¡é€»è¾‘
        doSomething();
    } finally {
        TFI.stop();
        TFI.report();
    }
}

// 2. æ³¨è§£æ–¹å¼
@TFITask("processOrder")
@TFIMetrics({"orderAmount", "itemCount"})
public Order processOrder(OrderRequest request) {
    return orderService.process(request);
}

// 3. å˜æ›´è¿½è¸ª
@TFITask("updateOrder")
@TFITrackChanges
public Order updateOrder(Order order) {
    order.setStatus(OrderStatus.CONFIRMED);
    order.setAmount(calculateAmount());
    return order;
}

// 4. æµå¼API
TFI.task("complexProcess")
   .trackObject(order, "status", "amount")
   .checkpoint("validation passed")
   .execute(() -> {
       // ä¸šåŠ¡é€»è¾‘
   })
   .report(Reporters.HTML);
```

### 10.3 é…ç½®ç¤ºä¾‹

```yaml
# application.yml
tfi:
  enabled: true
  auto-track:
    enabled: true
    packages:
      - com.example.service
      - com.example.controller
  performance:
    threshold: 100ms
    sample-rate: 1.0
  reporters:
    console:
      enabled: true
      show-metrics: true
    html:
      enabled: true
      output-dir: ./reports
    json:
      enabled: false
  change-tracking:
    enabled: true
    max-depth: 3
```

### 10.4 è¾“å‡ºç¤ºä¾‹

#### æ§åˆ¶å°è¾“å‡º
```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  TaskFlow Insight Report
  Time: 2024-12-28 10:30:45
  Thread: http-nio-8080-exec-1
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

processOrder (245ms) âš ï¸ SLOW
â”œâ”€â”€ validateOrder (12ms) âœ…
â”‚   â”œâ”€â”€ checkUser (3ms)
â”‚   â”œâ”€â”€ checkInventory (8ms)
â”‚   â””â”€â”€ checkPayment (1ms)
â”œâ”€â”€ calculatePrice (180ms) ğŸ”¥ BOTTLENECK
â”‚   â”œâ”€â”€ fetchDiscounts (150ms) ğŸ¢
â”‚   â”‚   â”œâ”€â”€ queryDatabase (120ms)
â”‚   â”‚   â””â”€â”€ applyRules (30ms)
â”‚   â””â”€â”€ applyTax (30ms)
â”œâ”€â”€ createPayment (43ms)
â”‚   â””â”€â”€ callPaymentGateway (40ms)
â””â”€â”€ notifyUser (10ms)
    â”œâ”€â”€ sendEmail (8ms)
    â””â”€â”€ sendSMS (2ms)

ğŸ“Š Performance Summary:
  - Total Time: 245ms
  - Self Time: 0ms
  - Critical Path: processOrder â†’ calculatePrice â†’ fetchDiscounts â†’ queryDatabase
  - Bottleneck: fetchDiscounts (61.2% of total time)

ğŸ”„ State Changes:
  - Order.status: PENDING â†’ VALIDATED (12ms)
  - Order.amount: 0.00 â†’ 1234.56 (192ms)
  - Order.status: VALIDATED â†’ CONFIRMED (235ms)

ğŸ’¡ Optimization Suggestions:
  1. Cache discount data to reduce database queries
  2. Optimize queryDatabase method (currently 120ms)
  3. Consider async notification for sendEmail

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

#### HTMLæŠ¥å‘Šé¢„è§ˆ
```html
<!-- äº¤äº’å¼æ ‘å½¢å›¾ -->
<div id="task-tree">
  <!-- D3.jsæ¸²æŸ“çš„å¯äº¤äº’æ ‘å½¢å›¾ -->
  <!-- æ”¯æŒå±•å¼€/æŠ˜å ã€æ‚¬åœæ˜¾ç¤ºè¯¦æƒ…ã€ç‚¹å‡»æŸ¥çœ‹æ›´å¤š -->
</div>

<!-- æ€§èƒ½åˆ†æå›¾è¡¨ -->
<div id="performance-charts">
  <!-- è€—æ—¶åˆ†å¸ƒé¥¼å›¾ -->
  <!-- æ—¶é—´è½´ç”˜ç‰¹å›¾ -->
  <!-- TOP Næ…¢æ–¹æ³•æŸ±çŠ¶å›¾ -->
</div>

<!-- å˜æ›´è®°å½•è¡¨ -->
<table id="change-records">
  <tr>
    <th>æ—¶é—´</th>
    <th>å¯¹è±¡</th>
    <th>å­—æ®µ</th>
    <th>æ—§å€¼</th>
    <th>æ–°å€¼</th>
    <th>ä»»åŠ¡ä¸Šä¸‹æ–‡</th>
  </tr>
  <!-- æ•°æ®è¡Œ -->
</table>
```

---

## 11. å¤šçº¿ç¨‹ä¸å¤šä¼šè¯ç®¡ç†

### 11.1 ä¼šè¯æ¨¡å‹
- ä¼šè¯æ ‡è¯†ï¼š`sessionId(UUID)`ï¼Œä¸ `threadId` ç»‘å®šï¼Œä¸€ä¸ªçº¿ç¨‹å¯æ‹¥æœ‰å¤šä¸ªå†å²ä¼šè¯ã€‚
- æ•°æ®ç»“æ„ï¼š`Map<Long, Deque<Session>>`ï¼Œæ¯çº¿ç¨‹ç»´æŠ¤æœ€è¿‘ `N` ä¸ªä¼šè¯ï¼ˆé»˜è®¤ N=10ï¼Œå¯é…ç½®ï¼‰ã€‚
- ä¼šè¯åŒ…å«ï¼š`sessionIdã€threadIdã€createdAtã€endedAtã€rootNode`ã€‚

### 11.2 ç”Ÿå‘½å‘¨æœŸä¸æ¸…ç†
- è‡ªåŠ¨æ¸…ç†ä»…é’ˆå¯¹â€œå·²ç»“æŸä¸”è¶…æ—¶â€çš„ä¼šè¯ï¼š`endTime>0 && now-endTime>cleanupInterval`ã€‚
- æ¸…ç†å‘¨æœŸé»˜è®¤ `PT5M`ï¼ˆ5åˆ†é’Ÿï¼‰ï¼Œé¦–æ¬¡ä¸å»¶è¿Ÿï¼›å‡å¯é…ç½®ã€‚
- æœ€åä¸€ä¸ªæ ¹ä»»åŠ¡ `stop` æ—¶ï¼šé‡ç½®ä¸Šä¸‹æ–‡ã€é€’å‡ root è®¡æ•°ï¼Œå¿…è¦æ—¶ `ThreadLocal.remove()`ï¼ˆçº¿ç¨‹æ± å‹å¥½ï¼‰ã€‚

### 11.3 æ£€ç´¢ä¸å¯¼å‡º
- æ”¯æŒæŒ‰ `sessionId`ã€`threadId`ã€æœ€è¿‘ N ä¸ªä¼šè¯æ£€ç´¢ï¼›æ”¯æŒé™åˆ¶æ·±åº¦ `maxDepth` ä¸èŠ‚ç‚¹æ•° `maxNodes`ã€‚

## 12. ç»Ÿè®¡å£å¾„ä¸æ—¶é—´æº

### 12.1 æ—¶é•¿å£å¾„
- è‡ªèº«æ—¶é•¿ `selfDuration`: èŠ‚ç‚¹è‡ªèº«è€—æ—¶ï¼ˆä¸å«å­èŠ‚ç‚¹ï¼‰ã€‚
- ç´¯è®¡æ—¶é•¿ `accDuration`: èŠ‚ç‚¹è‡ªèº« + å­æ ‘æ€»è€—æ—¶ï¼›å±•ç¤ºä¸åˆ†æä½¿ç”¨ç´¯è®¡ä¸ºä¸»ã€‚
- è¿è¡Œä¸­èŠ‚ç‚¹ï¼š`accDuration(now)= (nowNano - startNano)` å…œåº•ï¼Œé¿å…è´Ÿå€¼ã€‚

### 12.2 æ—¶é—´æºä¸å•ä½
- è®¡ç®—ä½¿ç”¨ `System.nanoTime()`ï¼ˆå•è°ƒã€ç²¾ç¡®ï¼‰ï¼›å±•ç¤ºè½¬æ¢ä¸ºæ¯«ç§’ã€‚
- èŠ‚ç‚¹ä¿ç•™ `startMillis/endMillis` ä¾¿äºäººè¯»ä¸æ—¥å¿—å¯¹é½ã€‚

## 13. èµ„æºæ²»ç†ä¸é‡‡æ ·ç­–ç•¥

### 13.1 ä¸Šé™ä¸æˆªæ–­
- `maxMessagesPerTask`ã€`maxSubtasksPerTask`ã€`maxDepth`ã€`maxSessionsPerThread` å¯é…ç½®ã€‚
- è¶…é™æ—¶æˆªæ–­å¹¶è¿½åŠ â€œæˆªæ–­æç¤ºâ€æ¶ˆæ¯ï¼ˆå«åŸè®¡åˆ’ã€å®é™…è®°å½•æ•°é‡ï¼‰ã€‚

### 13.2 é‡‡æ ·
- æ”¯æŒä¼šè¯çº§ä¸èŠ‚ç‚¹çº§é‡‡æ ·ï¼š`samplingRate âˆˆ [0,1]`ï¼›å¼‚å¸¸é“¾è·¯å¼ºåˆ¶ä¿ç•™ã€‚
- æä¾›æ ‡ç­¾ç™½åå•ï¼ˆå¦‚å…³é”®æµç¨‹ï¼‰å¼ºåˆ¶é‡‡é›†ã€‚

### 13.3 JVM èµ„æºå¿«ç…§ï¼ˆå¯é€‰ï¼‰
- è®°å½•å †/éå †ä½¿ç”¨é‡ï¼ˆ`MemoryMXBean`ï¼‰ã€çº¿ç¨‹æ•°ã€ç›´æ¥å†…å­˜ä¼°ç®—ï¼›é¢‘ç‡ä¸å¼€é”€å¯æ§ã€‚

## 14. æ•°æ®æ¨¡å‹ä¸ JSON Schema

### 14.1 èŠ‚ç‚¹æ¨¡å‹
```json
{
  "id": "string",
  "name": "string",
  "startMillis": 0,
  "endMillis": 0,
  "selfDurationNs": 0,
  "accDurationNs": 0,
  "status": "RUNNING|DONE",
  "cpuNs": 0,
  "messages": [
    {"type":"FLOW|METRIC|EXCEPTION|CHANGE","ts":0,"level":"INFO|WARN|ERROR","content":"...","kv":{}}
  ],
  "children": []
}
```

### 14.2 ä¼šè¯æ¨¡å‹
```json
{
  "sessionId": "uuid",
  "threadId": 123,
  "createdAt": 0,
  "endedAt": 0,
  "root": { /* TaskNode */ }
}
```

## 15. é›†æˆä¸å¯è§‚æµ‹æ€§

### 15.1 Micrometer æŒ‡æ ‡ï¼ˆå¯é€‰ï¼‰
- è®¡æ•°ä¸åˆ†å¸ƒï¼š`tfi_task_count`ã€`tfi_tree_depth`ã€`tfi_acc_duration_hist`ã€‚
- èµ„æºä¸æ²»ç†ï¼š`tfi_truncation_count`ã€`tfi_cleanup_count`ã€‚

### 15.2 OpenTelemetryï¼ˆå¯é€‰ï¼‰
- æ ¹/å­èŠ‚ç‚¹æ˜ å°„ä¸º Spanï¼›å±æ€§åŒ…å« `sessionIdã€taskPathã€accDurationMs`ã€‚
- ä¸ç°ç½‘ APM å¹¶å­˜ï¼Œé‡‡æ ·ä»¥ TFI é…ç½®ä¸ºä¸»ï¼Œå¯æ¡¥æ¥ OTel é‡‡æ ·ã€‚

### 15.3 æ—¥å¿— MDC
- æ³¨å…¥ `sessionIdã€threadIdã€taskPath`ï¼Œä¾¿äºè·¨æ—¥å¿—å…³è”ã€‚

## 16. å®‰å…¨ä¸åˆè§„

### 16.1 è„±æ•ä¸ç™½åå•
- æ¶ˆæ¯ä¸å˜æ›´è®°å½•é»˜è®¤è„±æ•ï¼ˆé‚®ç®±/æ‰‹æœºå·/èº«ä»½è¯ç­‰ï¼‰ï¼›æä¾›å­—æ®µç™½åå•ä¸è§„åˆ™é…ç½®ã€‚

### 16.2 æ•°æ®è¾“å‡ºæ§åˆ¶
- å¯¼å‡º JSON/æŠ¥å‘Šçš„å¼€å…³ã€é‡‡æ ·ç‡ä¸æœ€å¤§ä½“é‡å¯é…ç½®ï¼›å¯¹å¯èƒ½å«æ•æ„Ÿæ•°æ®çš„å¯¼å‡ºæä¾›æƒé™æ§åˆ¶å»ºè®®ã€‚

## 17. éåŠŸèƒ½ä¸éªŒæ”¶æ ‡å‡†

### 17.1 æ€§èƒ½
- é»˜è®¤å¼€é”€ï¼šCPU < 3%ï¼Œååä¸‹é™ < 5%ï¼ˆå…¸å‹é“¾è·¯ï¼‰ï¼›å¯¼å‡º/æ‰“å°ä¸ºå¼‚æ­¥ä¸é˜»å¡ä¸»æµç¨‹ã€‚

### 17.2 çº¿ç¨‹å®‰å…¨ä¸ä¸€è‡´æ€§
- å¹¶å‘å‹æµ‹æ— æ­»é”/NPEï¼›è·¨çº¿ç¨‹è¯»å–ä¸€è‡´ï¼›è¿è¡Œä¸­/å·²ç»“æŸæ—¶é•¿è®¡ç®—ä¸€è‡´ã€‚

### 17.3 å†…å­˜ä¸é•¿ç¨³
- 24h é•¿ç¨³æµ‹è¯•å †å¢é•¿ < 100MBï¼›æ—  ThreadLocal æ®‹ç•™ï¼ˆçº¿ç¨‹æ± åœºæ™¯éªŒè¯ï¼‰ã€‚

## 18. æµ‹è¯•è®¡åˆ’

- å•å…ƒæµ‹è¯•ï¼šåµŒå¥—è®¡æ—¶ã€è¿è¡Œä¸­ä¸å·²ç»“æŸå£å¾„ã€å¤šæ ¹ä¼šè¯ã€æ¶ˆæ¯ä¸Šé™ä¸æˆªæ–­ã€æ¸…ç†ç­–ç•¥ï¼ˆè¯¯åˆ ä¿æŠ¤ï¼‰ã€‚
- å¹¶å‘æµ‹è¯•ï¼šå¤šçº¿ç¨‹ç‹¬ç«‹ä¸Šä¸‹æ–‡/è·¨çº¿ç¨‹è¯»å–ï¼›æ‰“å°/æ¸…ç†ä¸å†™å…¥äº¤é”™ã€‚
- æ€§èƒ½æµ‹è¯•ï¼šå…¸å‹é“¾è·¯å¼€é”€è¯„ä¼°ã€é‡‡æ ·ä¸ä¸Šé™å¯¹æ€§èƒ½çš„å½±å“ã€‚
- é•¿ç¨³æµ‹è¯•ï¼šå‹åŠ› 24h å†…å­˜æ›²çº¿ã€æ¸…ç†æ•ˆæœä¸ä¼šè¯å›æ”¾æ­£ç¡®æ€§ã€‚

## 19. é‡Œç¨‹ç¢‘ä¸å‘å¸ƒè®¡åˆ’

- M1ï¼ˆæ ¸å¿ƒé—­ç¯ï¼‰ï¼šä¼šè¯æ¨¡å‹ã€ç»Ÿä¸€å£å¾„ã€ä½œç”¨åŸŸ APIã€è‡ªåŠ¨æ¸…ç†ã€æ–‡æœ¬/JSON å¯¼å‡ºã€é…ç½®é¡¹ã€‚
- M2ï¼ˆè§‚æµ‹/æ²»ç†ï¼‰ï¼šCPU/JVM å¿«ç…§ã€Micrometerã€MDCã€é‡‡æ ·ä¸æˆªæ–­ã€è„±æ•ç­–ç•¥ã€‚
- M3ï¼ˆç”Ÿæ€ï¼‰ï¼šOpenTelemetry å¯¼å‡ºã€å¯è§†åŒ–ç¤ºä¾‹ï¼ˆGrafana/å‰ç«¯æ ‘æ¸²æŸ“ï¼‰ã€å†…å­˜æ³„æ¼å¯å‘å¼æ£€æµ‹ã€‚

## 20. è¯„å®¡é‡‡çº³ä¸åŸåˆ™æ›´æ–°ï¼ˆæ–°å¢ï¼‰
- å¹¶å‘è¯»å–ä¸€è‡´æ€§ï¼šé‡‡ç”¨ä¸å¯å˜å¿«ç…§ï¼ˆCOWï¼‰ç­–ç•¥ï¼›ç»“æŸä¼šè¯å†»ç»“æ ‘ï¼Œè¿è¡Œä¸­å¯¼å‡ºåšè½»é‡å¿«ç…§ï¼Œç¡®ä¿è¯»å†™è§£è€¦ã€‚
- è§£è€¦ä¸æ‰©å±•ï¼šå¼•å…¥ `ChangeDetector`ï¼ˆSPIï¼‰ä¸ `Exporter` æ‰©å±•ç‚¹ï¼›JSON å†…ç½®ï¼ŒOTLP/OTel é€‚é…åœ¨ M2ã€‚
- é…ç½®ä¸è¯Šæ–­ï¼šå…³é”®é˜ˆå€¼èŒƒå›´æ ¡éªŒä¸å¯åŠ¨è¯Šæ–­è¾“å‡ºï¼›è¶Šç•Œå›é€€é»˜è®¤å¹¶è®°å½•è­¦å‘Šã€‚
- æŒ‡æ ‡ä¸å‘Šè­¦ï¼šç»„ä»¶ä»…æš´éœ² Micrometer æŒ‡æ ‡ï¼Œå‘Šè­¦åœ¨ Prometheus/Alertmanager ä¸­é…ç½®ï¼Œä¸å†…ç½®é€šé“ã€‚
- å…¼å®¹ä¸æµ‹è¯•ï¼šåŠ å…¥æé™å‹æµ‹ã€å¤š JDK/Boot ç‰ˆæœ¬å…¼å®¹éªŒè¯ï¼Œç¡®ä¿ç”Ÿäº§å°±ç»ªã€‚

## 21. ç¤ºæ„å›¾ï¼ˆæ–°å¢ï¼‰

### 21.1 COW ä¸å¯å˜å¿«ç…§æµç¨‹
```mermaid
flowchart TD
  A[ä¸šåŠ¡æ‰§è¡Œ: start/stop æ„å»ºæ ‘] --> B{ä¼šè¯ç»“æŸ?}
  B -- æ˜¯ --> C[å†»ç»“ä¸ºä¸å¯å˜æ ‘ (Freeze Immutable)]
  C --> D[å†™å…¥ allSessions / æœ€è¿‘ N]
  D --> E[è·¨çº¿ç¨‹è¯»å–: é›¶é”/é›¶å¤åˆ¶]
  B -- å¦ --> F[å¯¼å‡ºè§¦å‘: è½»é‡å¿«ç…§ (å—é™æ·±åº¦/èŠ‚ç‚¹æ•°)]
  F --> G[æ¸²æŸ“ JSON/æ–‡æœ¬æ ‘]
  E --> G
  note right of F: è¿è¡Œä¸­è¯»å–ä¸é˜»å¡å†™è·¯å¾„
```

### 21.2 SPI è£…é…å…³ç³»å›¾
```mermaid
graph LR
  Client[ä¸šåŠ¡ä»£ç ] -->|è°ƒç”¨| TFI[TFI API]
  TFI -->|SPI: ServiceLoader| ChangeDetector
  TFI -->|å¯¼å‡º| Exporter

  subgraph SPI æ‰©å±•ç‚¹
    ChangeDetector -.-> Impl1[ObjectComparatorBridge]
    ChangeDetector -.-> Impl2[CustomDetector...]
    Exporter -.-> JsonExporter[JSON å¯¼å‡º (å†…ç½®)]
    Exporter -.-> OtelExporter[OTLP/OTel å¯¼å‡º (M2)]
  end

  JsonExporter --> JSON[JSON æŠ¥æ–‡]
  OtelExporter --> OTLP[OTLP Payload]
```

## æ–‡æ¡£ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä½œè€… | å˜æ›´è¯´æ˜ |
|------|------|------|----------|
| 1.0.0 | 2024-12-28 | Product Team | åˆå§‹ç‰ˆæœ¬ |

## æ–‡æ¡£å®¡æ‰¹

| è§’è‰² | å§“å | å®¡æ‰¹ç»“æœ | æ—¥æœŸ |
|------|------|----------|------|
| äº§å“è´Ÿè´£äºº | - | å¾…å®¡æ‰¹ | - |
| æŠ€æœ¯è´Ÿè´£äºº | - | å¾…å®¡æ‰¹ | - |
| é¡¹ç›®è´Ÿè´£äºº | - | å¾…å®¡æ‰¹ | - |

---

**è”ç³»æ–¹å¼**
- GitHub: https://github.com/your-org/taskflow-insight
- Email: taskflow-insight@example.com
- Documentation: https://taskflow-insight.io/docs

**License**: Apache License 2.0

**Contributing**: æ¬¢è¿è´¡çŒ®ï¼è¯·æŸ¥çœ‹ [CONTRIBUTING.md](CONTRIBUTING.md) äº†è§£å¦‚ä½•å‚ä¸é¡¹ç›®ã€‚

---

*æœ¬æ–‡æ¡£ä½¿ç”¨ Markdown æ ¼å¼ç¼–å†™ï¼Œå»ºè®®ä½¿ç”¨æ”¯æŒ Markdown çš„ç¼–è¾‘å™¨æŸ¥çœ‹ä»¥è·å¾—æœ€ä½³é˜…è¯»ä½“éªŒã€‚*
