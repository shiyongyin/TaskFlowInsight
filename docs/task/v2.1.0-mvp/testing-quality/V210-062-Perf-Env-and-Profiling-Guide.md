# V210-062: 性能基线环境与 Profiling 指南

- 优先级：P0  
- 预估工期：S（<2天）  
- Phase：测试与发布  
- Owner：待定  
- 前置依赖：核心路径可运行

## 目标
- 建立可复现的性能测试环境与方法论，遵循“<5% CPU 开销 + 不回退”护栏；
- 固化 JVM/硬件/OS/运行参数，记录元数据，支持对比。

## 基线环境（建议）
- JDK：Temurin/OpenJDK 21；
- GC：G1GC（默认）；
- JVM：`-Xms512m -Xmx512m -XX:+AlwaysPreTouch`（可选）
- OS：记录发行版/内核；
- 硬件：记录 CPU 型号/主频/核心数、内存容量；
- CPU governor：固定 Performance，禁省电模式；
- 进程亲和与干扰：尽可能独占；
- 工具：JMH（微基准，可选）、JUnit + stopwatch（集成路径），JFR/async-profiler（分析）。

## 运行方法
- 预热 ≥ 5s；测量 ≥ 30s；重复 ≥ 5 次；剔除极端值；
- 记录 Git SHA、运行日期、配置、样例规格（层数/字段数/集合大小）。

## 指标与护栏
- 护栏：< 5% CPU 开销（相对业务或基线）；不劣化既有基线；
- 采集：平均/中位数/P95；内存峰值；GC 次数/停顿；
- 报告：以 JSON/Markdown 归档，随 PR 提供。

## 验收标准
- [ ] 基线规范落档并在仓库可见；
- [ ] 关键改动附带不回退对比；
- [ ] 发现异常时能定位（JFR/火焰图）。

## 对现有代码的影响（Impact）
- 影响级别：低。
- 行为：无代码变更，规范测试环境与流程；
- 运行：可能新增 perf 专项任务（不影响日常 CI）。
