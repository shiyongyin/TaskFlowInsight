# TaskFlowInsight (TFI) äº§å“éœ€æ±‚æ–‡æ¡£ (PRD)

> **ç‰ˆæœ¬**: v3.0.0 / v4.0.0-routing-refactor  
> **ç¼–å†™è§’è‰²**: èµ„æ·±äº§å“ç»ç†  
> **æ›´æ–°æ—¥æœŸ**: 2026-02-16  
> **æ–‡æ¡£çŠ¶æ€**: æ­£å¼ç‰ˆ

---

## ç›®å½•

- [1. äº§å“æ¦‚è¿°](#1-äº§å“æ¦‚è¿°)
- [2. ç›®æ ‡ç”¨æˆ·](#2-ç›®æ ‡ç”¨æˆ·)
- [3. æ ¸å¿ƒä»·å€¼ä¸»å¼ ](#3-æ ¸å¿ƒä»·å€¼ä¸»å¼ )
- [4. åŠŸèƒ½æ¸…å•](#4-åŠŸèƒ½æ¸…å•)
- [5. åŠŸèƒ½è¯¦ç»†è¯´æ˜](#5-åŠŸèƒ½è¯¦ç»†è¯´æ˜)
- [6. ç”¨æˆ·åœºæ™¯ä¸ç”¨ä¾‹](#6-ç”¨æˆ·åœºæ™¯ä¸ç”¨ä¾‹)
- [7. éåŠŸèƒ½æ€§éœ€æ±‚](#7-éåŠŸèƒ½æ€§éœ€æ±‚)
- [8. ç«å“åˆ†æ](#8-ç«å“åˆ†æ)
- [9. ç‰ˆæœ¬è·¯çº¿å›¾](#9-ç‰ˆæœ¬è·¯çº¿å›¾)
- [10. éªŒæ”¶æ ‡å‡†](#10-éªŒæ”¶æ ‡å‡†)
- [11. é£é™©ä¸çº¦æŸ](#11-é£é™©ä¸çº¦æŸ)

---

## 1. äº§å“æ¦‚è¿°

### 1.1 äº§å“å®šä½

TaskFlowInsight (TFI) æ˜¯ä¸€æ¬¾é¢å‘ Java å¼€å‘è€…çš„**ä¸šåŠ¡æµç¨‹å¯è§†åŒ–ä¸å˜æ›´è¿½è¸ªå¼€å‘è€…å·¥å…·åº“**ã€‚å®ƒä»¥"è®©ä¸šåŠ¡æµç¨‹è‡ªå·±è¯´è¯"ä¸ºæ ¸å¿ƒç†å¿µï¼Œé€šè¿‡éä¾µå…¥å¼çš„æ–¹å¼è‡ªåŠ¨ç”Ÿæˆæµç¨‹æ‰§è¡Œæ ‘å’Œå¯¹è±¡çŠ¶æ€å˜åŒ–æŠ¥å‘Šï¼Œä¸ºå¼€å‘è€…æä¾›"X å…‰å¼"çš„ä»£ç æ‰§è¡Œæ´å¯Ÿèƒ½åŠ›ã€‚

### 1.2 äº§å“å½¢æ€

- **ç±»å‹**: Java åº“ (Library / SDK)
- **åˆ†å‘æ–¹å¼**: Maven ä¾èµ–åŒ…
- **é›†æˆæ–¹å¼**: Spring Boot Starter è‡ªåŠ¨é…ç½® / çº¯ Java æ‰‹åŠ¨é›†æˆ
- **è¿è¡Œç¯å¢ƒ**: JDK 21+, Spring Boot 3.x

### 1.3 ä¸€å¥è¯æè¿°

> TFI æ˜¯ä¸€ä¸ªéä¾µå…¥ã€é›¶æ³„æ¼çš„ Java ä¸šåŠ¡æµç¨‹å¯è§†åŒ–å·¥å…·ï¼Œè®©å¼€å‘è€…ç”¨ä¸€è¡Œä»£ç è¿½è¸ªä¸šåŠ¡æ‰§è¡Œè·¯å¾„å’Œå¯¹è±¡å˜æ›´ã€‚

---

## 2. ç›®æ ‡ç”¨æˆ·

### 2.1 ç”¨æˆ·ç”»åƒ

| è§’è‰² | åœºæ™¯ | ç—›ç‚¹ | TFI ä»·å€¼ |
|------|------|------|----------|
| **Java åç«¯å¼€å‘** | å¤æ‚ä¸šåŠ¡æµç¨‹è°ƒè¯• | çœ‹ä¸åˆ°æ‰§è¡Œè·¯å¾„ï¼Œåªèƒ½åŠ æ—¥å¿— | ä¸€è¡Œä»£ç å¯è§†åŒ–æ‰§è¡Œæ ‘ |
| **ä¸šåŠ¡æ¶æ„å¸ˆ** | æµç¨‹æ–‡æ¡£ç¼–å†™ | ä»£ç å®ç°ä¸æ–‡æ¡£ä¸åŒæ­¥ | è‡ªåŠ¨ç”Ÿæˆæµç¨‹æ–‡æ¡£ |
| **è´¨é‡å·¥ç¨‹å¸ˆ** | å›å½’æµ‹è¯•éªŒè¯ | éš¾ä»¥ç²¾ç¡®éªŒè¯å¯¹è±¡å˜æ›´ | è‡ªåŠ¨å˜æ›´æ£€æµ‹ä¸æŠ¥å‘Š |
| **æŠ€æœ¯å›¢é˜Ÿ Leader** | Code Review | éš¾ä»¥ç†è§£ä¸šåŠ¡æµç¨‹ | æµç¨‹æ ‘ + å˜æ›´è®°å½•ä¸€ç›®äº†ç„¶ |
| **DevOps å·¥ç¨‹å¸ˆ** | ç”Ÿäº§é—®é¢˜æ’æŸ¥ | ç¼ºå°‘ä¸šåŠ¡çº§ç›‘æ§ | Actuator ç«¯ç‚¹å®æ—¶è§‚æµ‹ |

### 2.2 ç”¨æˆ·è§„æ¨¡é¢„æœŸ

| é˜¶æ®µ | æ—¶é—´ | ç›®æ ‡ |
|------|------|------|
| ç§å­æœŸ | v3.0 | å†…éƒ¨å›¢é˜Ÿä½¿ç”¨ï¼Œ5-10 ä¸ªé¡¹ç›®é›†æˆ |
| æˆé•¿æœŸ | v4.0 | å¼€æºç¤¾åŒºæ¨å¹¿ï¼Œ50+ é¡¹ç›®é›†æˆ |
| æˆç†ŸæœŸ | v5.0 | ä¼ä¸šçº§å®¢æˆ·ï¼Œ200+ é¡¹ç›®é›†æˆ |

---

## 3. æ ¸å¿ƒä»·å€¼ä¸»å¼ 

### 3.1 ä»·å€¼ä¸‰è§’

```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    ä¸šåŠ¡å¯è§†åŒ–         â”‚
        â”‚  "çœ‹è§"æ‰§è¡Œæµç¨‹       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
â”‚  å˜æ›´è¿½è¸ª    â”‚         â”‚  é›¶ä¾µå…¥      â”‚
â”‚ "æ•æ‰"çŠ¶æ€å˜åŒ–â”‚         â”‚ "æ— æ„Ÿ"æ¥å…¥    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ ¸å¿ƒå·®å¼‚åŒ–ä¼˜åŠ¿

| ç‰¹æ€§ | æè¿° | ç«å“å¯¹æ¯” |
|------|------|----------|
| **é›¶ä¾µå…¥** | ä¸ä¿®æ”¹ä¸šåŠ¡ç±»ï¼Œæ³¨è§£å¯é€‰ | å¤šæ•°è¿½è¸ªå·¥å…·éœ€ä¾µå…¥ |
| **é›¶æ³„æ¼** | è‡ªåŠ¨æ£€æµ‹å’Œæ¸…ç†ä¸Šä¸‹æ–‡æ³„æ¼ | ç‹¬æœ‰ç‰¹æ€§ |
| **å¼‚å¸¸å®‰å…¨** | TFI æ°¸ä¸æŠ›å‡ºå¼‚å¸¸åˆ°ä¸šåŠ¡ä»£ç  | ç‹¬æœ‰è®¾è®¡åŸåˆ™ |
| **å¤šç²’åº¦è¿½è¸ª** | æµ…å±‚å­—æ®µ + æ·±åº¦å¯¹è±¡å›¾ | å¤šæ•°åªæ”¯æŒå•ä¸€ç²’åº¦ |
| **æ™ºèƒ½æ¯”è¾ƒ** | @Entity/@ValueObject ç±»å‹ç³»ç»Ÿé©±åŠ¨ | åŸºäºæ³¨è§£çš„æ™ºèƒ½ç­–ç•¥é€‰æ‹© |
| **Spring ç”Ÿæ€åŸç”Ÿ** | Actuator + Micrometer + AOP | æ·±åº¦ Spring é›†æˆ |

---

## 4. åŠŸèƒ½æ¸…å•

### 4.1 åŠŸèƒ½æ¨¡å—æ€»è§ˆ

| æ¨¡å— | åŠŸèƒ½ | ä¼˜å…ˆçº§ | ç‰ˆæœ¬ | çŠ¶æ€ |
|------|------|--------|------|------|
| **F1** | æµç¨‹è¿½è¸ª (Task Flow) | P0 | v1.0 | âœ… å·²å®Œæˆ |
| **F2** | å˜æ›´è¿½è¸ª (Change Tracking) | P0 | v2.0 | âœ… å·²å®Œæˆ |
| **F3** | å¯¹è±¡æ¯”è¾ƒ (Object Compare) | P0 | v2.0 | âœ… å·²å®Œæˆ |
| **F4** | å¯¼å‡ºç³»ç»Ÿ (Export) | P1 | v2.0 | âœ… å·²å®Œæˆ |
| **F5** | Spring é›†æˆ | P0 | v2.0 | âœ… å·²å®Œæˆ |
| **F6** | æ³¨è§£é©±åŠ¨ (@TfiTask/@TfiTrack) | P1 | v2.5 | âœ… å·²å®Œæˆ |
| **F7** | Actuator è¿ç»´ç«¯ç‚¹ | P1 | v3.0 | âœ… å·²å®Œæˆ |
| **F8** | åº¦é‡æŒ‡æ ‡ (Metrics) | P2 | v3.0 | âœ… å·²å®Œæˆ |
| **F9** | å¥åº·æ£€æŸ¥ (Health) | P2 | v3.0 | âœ… å·²å®Œæˆ |
| **F10** | Provider è·¯ç”± (SPI) | P1 | v4.0 | ğŸ”„ å¼€å‘ä¸­ |
| **F11** | æ€§èƒ½ä»ªè¡¨æ¿ | P2 | v3.0 | âœ… å·²å®Œæˆ |
| **F12** | æ¸²æŸ“ç³»ç»Ÿ (Markdown/Style) | P2 | v3.0 | âœ… å·²å®Œæˆ |

---

## 5. åŠŸèƒ½è¯¦ç»†è¯´æ˜

### 5.1 F1 - æµç¨‹è¿½è¸ª

#### 5.1.1 åŠŸèƒ½æè¿°

è‡ªåŠ¨è®°å½•ä¸šåŠ¡æ‰§è¡Œæµç¨‹ï¼Œæ„å»ºå±‚çº§åŒ–çš„æ‰§è¡Œæ ‘ï¼ˆSession â†’ Task â†’ Stage â†’ Messageï¼‰ï¼Œæ”¯æŒåµŒå¥—å’Œå¼‚æ­¥ä¼ æ’­ã€‚

#### 5.1.2 æ ¸å¿ƒèƒ½åŠ›

| å­åŠŸèƒ½ | æè¿° | API |
|--------|------|-----|
| ä¼šè¯ç®¡ç† | åˆ›å»º/ç»“æŸè¿½è¸ªä¼šè¯ | `TFI.startSession()`, `TFI.endSession()` |
| é˜¶æ®µåˆ›å»º | AutoCloseable é˜¶æ®µ | `TFI.stage("name")` |
| å‡½æ•°å¼é˜¶æ®µ | Lambda + è¿”å›å€¼ | `TFI.stage("name", () -> result)` |
| æ¶ˆæ¯è®°å½• | è®°å½•å…³é”®èŠ‚ç‚¹ä¿¡æ¯ | `TFI.message()`, `TFI.error()` |
| å¼‚æ­¥ä¼ æ’­ | è·¨çº¿ç¨‹ä¸Šä¸‹æ–‡ä¼ é€’ | `TFI.wrapExecutor()` |
| å…¨å±€å¼€å…³ | è¿è¡Œæ—¶å¯åœ | `TFI.enable()`, `TFI.disable()` |

#### 5.1.3 ç”¨æˆ·æ•…äº‹

> **ä½œä¸º** Java åç«¯å¼€å‘  
> **æˆ‘å¸Œæœ›** é€šè¿‡ç®€å•çš„ä»£ç åŒ…è£¹è®°å½•ä¸šåŠ¡æµç¨‹  
> **ä»¥ä¾¿** åœ¨è°ƒè¯•æ—¶æ¸…æ™°çœ‹åˆ°æ‰§è¡Œè·¯å¾„å’Œè€—æ—¶

#### 5.1.4 éªŒæ”¶æ ‡å‡†

- [x] `try (var stage = TFI.stage("xxx"))` è¯­æ³•å¯æ­£å¸¸ä½¿ç”¨
- [x] åµŒå¥— stage æ­£ç¡®æ„å»ºçˆ¶å­å…³ç³»
- [x] å¼‚æ­¥çº¿ç¨‹ä¸­å¯ä»¥è®¿é—®çˆ¶çº¿ç¨‹ä¸Šä¸‹æ–‡
- [x] `TFI.disable()` åæ‰€æœ‰æ“ä½œä¸º no-op

### 5.2 F2 - å˜æ›´è¿½è¸ª

#### 5.2.1 åŠŸèƒ½æè¿°

è¿½è¸ª Java å¯¹è±¡çš„çŠ¶æ€å˜åŒ–ï¼Œåœ¨è®°å½•åŸºçº¿å¿«ç…§åï¼Œè‡ªåŠ¨æ£€æµ‹å­—æ®µå€¼çš„å¢åˆ æ”¹ã€‚

#### 5.2.2 æ ¸å¿ƒèƒ½åŠ›

| å­åŠŸèƒ½ | æè¿° | API |
|--------|------|-----|
| æµ…å±‚è¿½è¸ª | æŒ‡å®šå­—æ®µè¿½è¸ª | `TFI.track("name", obj, "field1", "field2")` |
| å…¨é‡è¿½è¸ª | è¿½è¸ªæ‰€æœ‰å­—æ®µ | `TFI.trackAll("name", obj)` |
| æ·±åº¦è¿½è¸ª | é€’å½’å¯¹è±¡å›¾è¿½è¸ª | `TFI.trackDeep("name", obj)` |
| è·å–å˜æ›´ | è·å–å˜æ›´è®°å½•åˆ—è¡¨ | `TFI.getChanges()` |
| æ¸…ç†è¿½è¸ª | é‡Šæ”¾èµ„æº | `TFI.clearAllTracking()` |
| æ¡ä»¶è¿½è¸ª | å¸¦é€‰é¡¹çš„è¿½è¸ª | `TFI.track("name", obj, TrackingOptions)` |

#### 5.2.3 ç”¨æˆ·æ•…äº‹

> **ä½œä¸º** è´¨é‡å·¥ç¨‹å¸ˆ  
> **æˆ‘å¸Œæœ›** è‡ªåŠ¨æ£€æµ‹å¯¹è±¡åœ¨ä¸šåŠ¡æµç¨‹ä¸­çš„çŠ¶æ€å˜åŒ–  
> **ä»¥ä¾¿** ç²¾ç¡®éªŒè¯ä¸šåŠ¡é€»è¾‘æ˜¯å¦æ­£ç¡®ä¿®æ”¹äº†ç›®æ ‡å­—æ®µ

#### 5.2.4 éªŒæ”¶æ ‡å‡†

- [x] æµ…å±‚è¿½è¸ªæ£€æµ‹åˆ°æŒ‡å®šå­—æ®µçš„å€¼å˜æ›´
- [x] æ·±åº¦è¿½è¸ªé€’å½’æ£€æµ‹åµŒå¥—å¯¹è±¡å˜æ›´
- [x] æ”¯æŒ `@DiffIgnore` æ’é™¤å­—æ®µ
- [x] æœ€å¤§è¿½è¸ªå¯¹è±¡æ•°å¯é…ç½®ï¼ˆé»˜è®¤ 1000ï¼‰
- [x] ThreadLocal éš”ç¦»ç¡®ä¿å¤šçº¿ç¨‹å®‰å…¨

### 5.3 F3 - å¯¹è±¡æ¯”è¾ƒ

#### 5.3.1 åŠŸèƒ½æè¿°

å¯¹ä¸¤ä¸ª Java å¯¹è±¡è¿›è¡Œæ·±åº¦å¯¹æ¯”ï¼Œè¾“å‡ºç»“æ„åŒ–çš„å·®å¼‚æŠ¥å‘Šï¼Œæ”¯æŒè‡ªå®šä¹‰æ¯”è¾ƒç­–ç•¥å’Œç±»å‹ç³»ç»Ÿæ³¨è§£ã€‚

#### 5.3.2 æ ¸å¿ƒèƒ½åŠ›

| å­åŠŸèƒ½ | æè¿° | API |
|--------|------|-----|
| ç®€å•æ¯”è¾ƒ | ä¸¤ä¸ªå¯¹è±¡æ¯”è¾ƒ | `TFI.compare(obj1, obj2)` |
| æ„å»ºå™¨ | æµå¼é…ç½®æ¯”è¾ƒ | `TFI.comparator().source(a).target(b).build()` |
| æ¸²æŸ“æŠ¥å‘Š | Markdown æŠ¥å‘Š | `TFI.render(result, "standard")` |
| ç±»å‹ç³»ç»Ÿ | æ³¨è§£é©±åŠ¨ç­–ç•¥é€‰æ‹© | `@Entity`, `@ValueObject`, `@Key` |
| ç²¾åº¦æ§åˆ¶ | æ•°å€¼/æ—¥æœŸç²¾åº¦ | `@NumericPrecision(scale=2)` |

#### 5.3.3 ç”¨æˆ·æ•…äº‹

> **ä½œä¸º** ä¸šåŠ¡æ¶æ„å¸ˆ  
> **æˆ‘å¸Œæœ›** èƒ½å¤Ÿæ¯”è¾ƒä¸¤ä¸ªç‰ˆæœ¬çš„ä¸šåŠ¡å¯¹è±¡å¹¶ç”Ÿæˆç»“æ„åŒ–æŠ¥å‘Š  
> **ä»¥ä¾¿** å¿«é€Ÿäº†è§£æ•°æ®å˜åŒ–å¹¶çº³å…¥å®¡è®¡è®°å½•

### 5.4 F4 - å¯¼å‡ºç³»ç»Ÿ

#### 5.4.1 æ ¸å¿ƒèƒ½åŠ›

| å¯¼å‡ºæ ¼å¼ | æè¿° | API |
|----------|------|-----|
| Console | æ ¼å¼åŒ–æ§åˆ¶å°è¾“å‡º | `TFI.exportToConsole()` |
| JSON | JSON å­—ç¬¦ä¸²å¯¼å‡º | `TFI.exportToJson()` |
| Map | ç»“æ„åŒ– Map å¯¼å‡º | `TFI.exportToMap()` |
| Markdown | æ¸²æŸ“æŠ¥å‘Š | `TFI.render(result, style)` |
| CSV | å˜æ›´è®°å½• CSV | `ChangeExporter` |
| XML | å˜æ›´è®°å½• XML | `ChangeXmlExporter` |
| Streaming | æµå¼å¯¼å‡º | `StreamingChangeExporter` |

### 5.5 F5 - Spring é›†æˆ

#### 5.5.1 è‡ªåŠ¨é…ç½®

```java
@SpringBootApplication
@EnableTfi(enableChangeTracking = true)
public class MyApplication { }
```

#### 5.5.2 æ³¨è§£é©±åŠ¨ (F6)

```java
@TfiTask(name = "å¤„ç†è®¢å•", condition = "#order.amount > 100")
public Order processOrder(Order order) {
    // ä¸šåŠ¡é€»è¾‘
}

@TfiTrack(fields = {"status", "amount"})
public void updateOrder(Order order) {
    // è‡ªåŠ¨è¿½è¸ª status å’Œ amount å˜åŒ–
}
```

### 5.6 F7/F8/F9 - è¿ç»´åŠŸèƒ½

| ç«¯ç‚¹ | è·¯å¾„ | åŠŸèƒ½ |
|------|------|------|
| TFI æ¦‚è§ˆ | `/actuator/taskflow` | å½“å‰ä¼šè¯å’Œä»»åŠ¡æ¦‚è§ˆ |
| ä¸Šä¸‹æ–‡è¯Šæ–­ | `/actuator/taskflow-context` | ä¸Šä¸‹æ–‡æ³„æ¼æ£€æµ‹ |
| TFI æŒ‡æ ‡ | `/actuator/tfi-metrics` | æ€§èƒ½æŒ‡æ ‡è¯»å–/é‡ç½® |
| å¥åº·æ£€æŸ¥ | `/actuator/health` | å†…å­˜/CPU/ç¼“å­˜/é”™è¯¯ç‡è¯„åˆ† |
| æ€§èƒ½ä»ªè¡¨æ¿ | `/actuator/tfi-advanced/*` | å®Œæ•´æ€§èƒ½ REST API |

### 5.7 F10 - Provider è·¯ç”± (v4.0.0)

#### 5.7.1 åŠŸèƒ½æè¿°

å…è®¸ç”¨æˆ·é€šè¿‡ SPI æœºåˆ¶æ›¿æ¢ TFI å†…éƒ¨çš„ä»»ä½•å­ç³»ç»Ÿå®ç°ï¼ŒåŒ…æ‹¬æµç¨‹ç®¡ç†ã€å˜æ›´è¿½è¸ªã€å¯¹è±¡æ¯”è¾ƒã€æ¸²æŸ“å’Œå¯¼å‡ºã€‚

#### 5.7.2 Provider ç±»å‹

| Provider | èŒè´£ | é»˜è®¤å®ç° |
|----------|------|----------|
| FlowProvider | ä¼šè¯/ä»»åŠ¡/æ¶ˆæ¯æµç¨‹ | DefaultFlowProvider |
| TrackingProvider | å˜æ›´è¿½è¸ª | DefaultTrackingProvider |
| ComparisonProvider | å¯¹è±¡æ¯”è¾ƒ | DefaultComparisonProvider |
| RenderProvider | Markdown æ¸²æŸ“ | DefaultRenderProvider |
| ExportProvider | å¯¼å‡º | DefaultExportProvider |

#### 5.7.3 æ³¨å†Œæ–¹å¼

```java
// æ–¹å¼1: ç¼–ç¨‹æ³¨å†Œ
TFI.registerComparisonProvider(new MyComparisonProvider());

// æ–¹å¼2: Spring Bean è‡ªåŠ¨å‘ç°
@Component
public class MyProvider implements ComparisonProvider { ... }

// æ–¹å¼3: ServiceLoader SPI
// META-INF/services/com.syy.taskflowinsight.spi.ComparisonProvider
```

---

## 6. ç”¨æˆ·åœºæ™¯ä¸ç”¨ä¾‹

### 6.1 åœºæ™¯ä¸€ï¼šç”µå•†è®¢å•æµç¨‹è¿½è¸ª

```
ç”¨æˆ·ä¸‹å• â†’ åˆ›å»ºè®¢å• â†’ æ‰£å‡åº“å­˜ â†’ è®¡ç®—ä¼˜æƒ  â†’ å‘èµ·æ”¯ä»˜ â†’ æ›´æ–°çŠ¶æ€
```

**TFI è¾“å‡ºç¤ºä¾‹**:

```
ğŸ“‹ Session: ç”¨æˆ·ä¸‹å• #ORD-20240101
 â”œâ”€â”€ ğŸ“Œ åˆ›å»ºè®¢å• [120ms]
 â”‚    â””â”€â”€ âœ‰ï¸ è®¢å•ID: ORD-20240101
 â”œâ”€â”€ ğŸ“Œ æ‰£å‡åº“å­˜ [45ms]
 â”‚    â””â”€â”€ âœ‰ï¸ SKU-001: 100 â†’ 99
 â”œâ”€â”€ ğŸ“Œ è®¡ç®—ä¼˜æƒ  [30ms]
 â”‚    â””â”€â”€ âœ‰ï¸ ä¼˜æƒ é‡‘é¢: Â¥50.00
 â”œâ”€â”€ ğŸ“Œ å‘èµ·æ”¯ä»˜ [200ms]
 â”‚    â””â”€â”€ âœ‰ï¸ æ”¯ä»˜æµæ°´: PAY-20240101
 â””â”€â”€ ğŸ“Œ æ›´æ–°çŠ¶æ€ [15ms]
      â””â”€â”€ âœ‰ï¸ PENDING â†’ PAID

ğŸ“Š å˜æ›´è¿½è¸ª:
 â€¢ order.status: PENDING â†’ PAID
 â€¢ order.amount: 500.00 â†’ 450.00
 â€¢ inventory.sku001.quantity: 100 â†’ 99
```

### 6.2 åœºæ™¯äºŒï¼šå®¡è®¡æ—¥å¿—ç”Ÿæˆ

```java
Order before = orderService.getOrder(orderId);
TFI.track("order", before, "status", "amount", "items");

orderService.modifyOrder(orderId, request);

List<ChangeRecord> changes = TFI.getChanges();
auditService.log(changes); // è‡ªåŠ¨ç”Ÿæˆå®¡è®¡è®°å½•
```

### 6.3 åœºæ™¯ä¸‰ï¼šå›å½’æµ‹è¯•éªŒè¯

```java
@Test
void shouldUpdateOrderCorrectly() {
    Order order = createTestOrder();
    TFI.trackAll("order", order);
    
    orderService.process(order);
    
    List<ChangeRecord> changes = TFI.getChanges();
    assertThat(changes)
        .extracting(ChangeRecord::fieldName)
        .contains("status", "processedAt")
        .doesNotContain("id", "createdAt");
}
```

### 6.4 åœºæ™¯å››ï¼šç”Ÿäº§é—®é¢˜æ’æŸ¥

```
GET /actuator/taskflow
â†’ è¿”å›å½“å‰æ´»è·ƒä¼šè¯ã€ä»»åŠ¡å †æ ˆã€æ³„æ¼æ£€æµ‹æŠ¥å‘Š

GET /actuator/taskflow-context
â†’ è¿”å›ä¸Šä¸‹æ–‡è¯Šæ–­ä¿¡æ¯ã€æ´»è·ƒçº¿ç¨‹æ•°ã€æ³„æ¼é£é™©

GET /actuator/health
â†’ è¿”å› TFI ç»„ä»¶å¥åº·çŠ¶æ€ (å†…å­˜/CPU/ç¼“å­˜/é”™è¯¯ç‡)
```

### 6.5 åœºæ™¯äº”ï¼šé…ç½®å¯¹æ¯” (v4.0.0)

```java
// å¯¹æ¯”ä¸¤ä¸ªé…ç½®ç‰ˆæœ¬
CompareResult result = TFI.compare(configV1, configV2);
String report = TFI.render(result, "detailed");
System.out.println(report);

// è¾“å‡º Markdown æ ¼å¼å·®å¼‚æŠ¥å‘Š
```

---

## 7. éåŠŸèƒ½æ€§éœ€æ±‚

### 7.1 æ€§èƒ½éœ€æ±‚

| æŒ‡æ ‡ | ç›®æ ‡ | å½“å‰çŠ¶æ€ |
|------|------|----------|
| Stage åˆ›å»º + å…³é—­ | < 50Î¼s (P95) | âœ… è¾¾æ ‡ |
| æµ…å±‚å¿«ç…§ (2 å­—æ®µ) | < 50Î¼s (P50) | âœ… è¾¾æ ‡ |
| Diff æ£€æµ‹ (2 å­—æ®µ) | < 200Î¼s (P95) | âœ… è¾¾æ ‡ |
| æ·±åº¦å¿«ç…§ (10 å±‚) | < 5ms (P95) | âœ… è¾¾æ ‡ |
| TFI ç¦ç”¨æ—¶å¼€é”€ | < 10ns | âœ… è¾¾æ ‡ (å®Œå…¨ no-op) |
| Provider è·¯ç”±å¼€é”€ | < 5% å›å½’ | ğŸ”„ CI ç›‘æ§ä¸­ |

### 7.2 å¯é æ€§éœ€æ±‚

| éœ€æ±‚ | æè¿° | å®ç°çŠ¶æ€ |
|------|------|----------|
| å¼‚å¸¸å®‰å…¨ | TFI ä¸å‘ä¸šåŠ¡ä»£ç æŠ›å‡ºå¼‚å¸¸ | âœ… å·²å®ç° |
| é›¶æ³„æ¼ | ä¸Šä¸‹æ–‡è‡ªåŠ¨æ£€æµ‹å’Œæ¸…ç†æ³„æ¼ | âœ… å·²å®ç° |
| çº¿ç¨‹å®‰å…¨ | æ‰€æœ‰å…¬å…± API çº¿ç¨‹å®‰å…¨ | âœ… å·²å®ç° |
| ä¼˜é›…é™çº§ | TFI ç¦ç”¨ = å®Œå…¨ no-op | âœ… å·²å®ç° |
| èµ„æºé™åˆ¶ | æœ€å¤§è¿½è¸ªå¯¹è±¡æ•°å¯é…ç½® | âœ… å·²å®ç° |
| é™çº§ç­–ç•¥ | è¶…è¿‡é˜ˆå€¼è‡ªåŠ¨é™çº§ | âœ… å·²å®ç° |

### 7.3 å…¼å®¹æ€§éœ€æ±‚

| ç»´åº¦ | è¦æ±‚ |
|------|------|
| JDK | 21+ |
| Spring Boot | 3.x |
| API å…¼å®¹ | japicmp ä¿è¯å‘åå…¼å®¹ |
| é Spring | çº¯ Java ç¯å¢ƒå¯ç”¨ (é™æ€å›é€€) |

### 7.4 å®‰å…¨éœ€æ±‚

| éœ€æ±‚ | æè¿° |
|------|------|
| æ•°æ®è„±æ• | `UnifiedDataMasker` æ”¯æŒæ•æ„Ÿå­—æ®µè„±æ• |
| ç«¯ç‚¹å®‰å…¨ | Actuator ç«¯ç‚¹å¯é…ç½®åªè¯» |
| æ— å¤–éƒ¨é€šä¿¡ | TFI ä¸å‘èµ·ä»»ä½•å¤–éƒ¨ç½‘ç»œè¯·æ±‚ |
| å†…å­˜å®‰å…¨ | å¿«ç…§å¤§å°é™åˆ¶ã€è¶…æ—¶æ¸…ç† |

---

## 8. ç«å“åˆ†æ

### 8.1 ç«å“çŸ©é˜µ

| ç‰¹æ€§ | TFI | Javers | Hibernate Envers | Spring AOP Log |
|------|-----|--------|------------------|----------------|
| æµç¨‹è¿½è¸ª | âœ… | âŒ | âŒ | éƒ¨åˆ† |
| å˜æ›´è¿½è¸ª | âœ… | âœ… | âœ… | âŒ |
| å¯¹è±¡æ¯”è¾ƒ | âœ… | âœ… | âŒ | âŒ |
| æ³¨è§£é©±åŠ¨ | âœ… | âœ… | âœ… | âœ… |
| å¼‚å¸¸å®‰å…¨ | âœ… | âŒ | âŒ | âŒ |
| é›¶æ³„æ¼ | âœ… | âŒ | N/A | âŒ |
| Actuator | âœ… | âŒ | âŒ | âŒ |
| é Spring | âœ… | âœ… | âŒ | âŒ |
| ç±»å‹ç³»ç»Ÿ | âœ… (@Entity/@ValueObject) | âœ… | âŒ | âŒ |
| SPI æ‰©å±• | âœ… (v4.0) | éƒ¨åˆ† | âŒ | âŒ |
| æ€§èƒ½ç›‘æ§ | âœ… | âŒ | âŒ | âŒ |

### 8.2 å·®å¼‚åŒ–å®šä½

TFI çš„ç‹¬ç‰¹å®šä½åœ¨äº**æµç¨‹è¿½è¸ª + å˜æ›´è¿½è¸ªçš„ä¸€ç«™å¼æ–¹æ¡ˆ**ï¼Œè¿™æ˜¯ Javers å’Œ Envers æ‰€ä¸å…·å¤‡çš„ã€‚åŒæ—¶ï¼ŒTFI çš„å¼‚å¸¸å®‰å…¨å’Œé›¶æ³„æ¼è®¾è®¡ä½¿å…¶åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ›´åŠ å®‰å…¨å¯é ã€‚

---

## 9. ç‰ˆæœ¬è·¯çº¿å›¾

### 9.1 å·²å‘å¸ƒç‰ˆæœ¬

| ç‰ˆæœ¬ | å‘å¸ƒæ—¶é—´ | æ ¸å¿ƒåŠŸèƒ½ |
|------|----------|----------|
| v1.0 | - | åŸºç¡€æµç¨‹è¿½è¸ª (Session/Task/Stage/Message) |
| v2.0 | - | å˜æ›´è¿½è¸ª + å¯¹è±¡æ¯”è¾ƒ + å¯¼å‡ºç³»ç»Ÿ |
| v2.5 | - | æ³¨è§£é©±åŠ¨ (@TfiTask/@TfiTrack) |
| v3.0 | - | Actuator ç«¯ç‚¹ + åº¦é‡æŒ‡æ ‡ + å¥åº·æ£€æŸ¥ + å¤šæ¨¡å—é‡æ„ |

### 9.2 å½“å‰ç‰ˆæœ¬ (v4.0.0)

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| Provider è·¯ç”± (SPI) | ğŸ”„ å¼€å‘ä¸­ | å¯æ’æ‹”å­ç³»ç»Ÿæ›¿æ¢ |
| ServiceLoader æ”¯æŒ | ğŸ”„ å¼€å‘ä¸­ | META-INF/services è‡ªåŠ¨å‘ç° |
| è·¯ç”±æ€§èƒ½é—¨æ§› | ğŸ”„ æµ‹è¯•ä¸­ | CI å›å½’ < 5% |
| API å…¼å®¹æ€§ä¿è¯ | âœ… | japicmp é›†æˆ |

### 9.3 è§„åˆ’ç‰ˆæœ¬

| ç‰ˆæœ¬ | è§„åˆ’åŠŸèƒ½ | ä¼˜å…ˆçº§ |
|------|----------|--------|
| v4.1 | OpenTelemetry é›†æˆ | P1 |
| v4.2 | Web UI å¯è§†åŒ–é¢æ¿ | P2 |
| v5.0 | GraalVM Native Image æ”¯æŒ | P2 |
| v5.0 | åˆ†å¸ƒå¼è¿½è¸ªä¸Šä¸‹æ–‡ä¼ æ’­ | P1 |

---

## 10. éªŒæ”¶æ ‡å‡†

### 10.1 åŠŸèƒ½éªŒæ”¶

| ç¼–å· | éªŒæ”¶é¡¹ | éªŒæ”¶æ–¹æ³• |
|------|--------|----------|
| AC-1 | æµç¨‹è¿½è¸ªç”Ÿæˆæ­£ç¡®çš„å±‚çº§æ ‘ | å•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯• |
| AC-2 | å˜æ›´è¿½è¸ªæ£€æµ‹æ‰€æœ‰å­—æ®µå˜åŒ– | å‚æ•°åŒ–æµ‹è¯• + é»„é‡‘æ–‡ä»¶ |
| AC-3 | å¯¹è±¡æ¯”è¾ƒæ”¯æŒæ‰€æœ‰ç­–ç•¥ | ç­–ç•¥çŸ©é˜µæµ‹è¯• |
| AC-4 | å¯¼å‡ºæ ¼å¼ç¬¦åˆè§„èŒƒ | ApprovalTests |
| AC-5 | Actuator ç«¯ç‚¹å¯æ­£å¸¸è®¿é—® | Spring Boot é›†æˆæµ‹è¯• |
| AC-6 | Provider è·¯ç”±æ­£ç¡®åˆ†å‘ | SPI æµ‹è¯• + è·¯ç”±æµ‹è¯• |
| AC-7 | TFI ç¦ç”¨æ—¶é›¶å¼€é”€ | JMH åŸºå‡†æµ‹è¯• |

### 10.2 è´¨é‡éªŒæ”¶

| ç¼–å· | éªŒæ”¶é¡¹ | æ ‡å‡† |
|------|--------|------|
| QA-1 | ä»£ç è¦†ç›–ç‡ | â‰¥ 50% æŒ‡ä»¤è¦†ç›–ç‡ (JaCoCo) |
| QA-2 | é™æ€åˆ†æ | SpotBugs 0 High ç¼ºé™· |
| QA-3 | ç¼–ç è§„èŒƒ | Checkstyle Google è§„èŒƒ |
| QA-4 | ä»£ç è´¨é‡ | PMD æ—  Critical è¿è§„ |
| QA-5 | API å…¼å®¹ | japicmp æ— ç ´åæ€§å˜æ›´ |
| QA-6 | æ€§èƒ½åŸºå‡† | JMH è·¯ç”±å›å½’ < 5% |

---

## 11. é£é™©ä¸çº¦æŸ

### 11.1 æŠ€æœ¯é£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|----------|
| æ·±åº¦è¿½è¸ªå†…å­˜æ¶ˆè€— | å¤§å¯¹è±¡å›¾å¯¼è‡´ OOM | `max-depth` é…ç½® + é™çº§ç­–ç•¥ |
| ThreadLocal æ³„æ¼ | çº¿ç¨‹æ± åœºæ™¯ | é›¶æ³„æ¼æ£€æµ‹ + `TFI.clear()` |
| Provider è·¯ç”±æ€§èƒ½ | é¢å¤–é—´æ¥è°ƒç”¨å¼€é”€ | CI æ€§èƒ½é—¨æ§› < 5% |
| JDK å‡çº§å…¼å®¹ | åå°„ API å˜æ›´ | æœ€å°åŒ–åå°„ä½¿ç”¨ |

### 11.2 äº§å“é£é™©

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|----------|
| ç”¨æˆ·å­¦ä¹ æˆæœ¬ | é™ä½é‡‡ç”¨ç‡ | å®Œå–„ç¤ºä¾‹ + æ¸è¿›å¼æ•™å­¦ |
| ä¸å·²æœ‰å·¥å…·é‡å  | ç”¨æˆ·çŠ¹è±« | å¼ºè°ƒä¸€ç«™å¼ + å·®å¼‚åŒ–ä»·å€¼ |
| ç¤¾åŒºæ´»è·ƒåº¦ | é•¿æœŸç»´æŠ¤ | å¼€æºè¿è¥ + ä¼ä¸šæ”¯æŒ |

### 11.3 çº¦æŸæ¡ä»¶

| çº¦æŸ | æè¿° |
|------|------|
| JDK ç‰ˆæœ¬ | ä»…æ”¯æŒ JDK 21+ï¼ˆä½¿ç”¨ Recordsã€è™šæ‹Ÿçº¿ç¨‹ï¼‰ |
| Spring ç‰ˆæœ¬ | ä»…æ”¯æŒ Spring Boot 3.x |
| æ„å»ºå·¥å…· | Mavenï¼ˆä¸æ”¯æŒ Gradleï¼‰ |
| è¯­è¨€ | ä»…æ”¯æŒ Javaï¼ˆä¸æ”¯æŒ Kotlin/Scala ç‰¹æ®Šè¯­æ³•ï¼‰ |

---

> **æ–‡æ¡£ç¼–å†™**: èµ„æ·±äº§å“ç»ç†  
> **å®¡æ ¸**: é¡¹ç›®ç»ç†  
> **ä¸‹æ¬¡è¯„å®¡æ—¥æœŸ**: ä¾æ®äº§å“è¿­ä»£èŠ‚å¥
